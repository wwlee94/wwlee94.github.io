{"componentChunkName":"component---src-templates-post-tsx","path":"/category/spring/toby-spring/service-abstraction/transaction/","result":{"data":{"site":{"siteMetadata":{"title":"Blausee 기술 블로그","author":"wwlee94","siteUrl":"https://wwlee94.github.io"}},"markdownRemark":{"id":"a69c4120-ca2b-5d89-91bf-b450cc72aef2","excerpt":"개요 5장에서는 지금까지 만든 DAO에 트랜잭션을 적용해보면서 스프링이 어떻게 비슷한 여러 종류의 기술을 추상화하며 일관된 방법으로 기술을 사용할 수 있도록 지원하는지를 살펴볼 예정 ! 5-1. 비즈니스 로직 5-1장에서는 다음과 같은 새로운 비즈니스 로직(Service…","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h2>\n<p>5장에서는 지금까지 만든 DAO에 트랜잭션을 적용해보면서 스프링이 어떻게 비슷한 여러 종류의 기술을 추상화하며 일관된 방법으로 기술을 사용할 수 있도록 지원하는지를 살펴볼 예정 !</p>\n<h2 id=\"5-1-비즈니스-로직\" style=\"position:relative;\"><a href=\"#5-1-%EB%B9%84%EC%A6%88%EB%8B%88%EC%8A%A4-%EB%A1%9C%EC%A7%81\" aria-label=\"5 1 비즈니스 로직 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5-1. 비즈니스 로직</h2>\n<p>5-1장에서는 다음과 같은 새로운 비즈니스 로직(Service)을 추가합니다.</p>\n<ol>\n<li>사용자의 레벨은 <code class=\"language-text\">BASIC</code>, <code class=\"language-text\">SILVER</code>, <code class=\"language-text\">GOLD</code> 세 가지 중 하나다.</li>\n<li>사용자가 처음 가입하면 <code class=\"language-text\">BASIC</code>, 이후 활동에 따라서 단계가 업그레이드</li>\n<li>가입 후 50회 이상 로그인시 <code class=\"language-text\">BASIC -&gt; SILVER</code></li>\n<li><code class=\"language-text\">SILVER</code>이면서 30번 이상 추천받으면 <code class=\"language-text\">GOLD</code>로 업그레이드</li>\n<li>사용자 레벨 변경 작업은 일정한 주기를 가지고 일괄적으로 적용된다.</li>\n</ol>\n<p><strong>위의 기능을 메소드화 없이, 한 곳에 로직을 몰아서 구현하면 ?!</strong></p>\n<div class=\"gatsby-code-title\">UserService.java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">// 전체 유저 조회 후 레벨 업그레이드 판단</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users <span class=\"token operator\">=</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user <span class=\"token operator\">:</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Boolean</span> changed <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Level</span> level <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 현재 레벨</span>\n        <span class=\"token keyword\">int</span> login <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 로그인 수</span>\n        <span class=\"token keyword\">int</span> recommend <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getRecommend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 추천 수</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>level <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>BASIC <span class=\"token operator\">&amp;&amp;</span> login <span class=\"token operator\">>=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            user<span class=\"token punctuation\">.</span><span class=\"token function\">setLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>SILVER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            changed <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>level <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>SILVER <span class=\"token operator\">&amp;&amp;</span> recommend <span class=\"token operator\">>=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            user<span class=\"token punctuation\">.</span><span class=\"token function\">setLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>GOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            changed <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>level <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>GOLD<span class=\"token punctuation\">)</span> changed <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">else</span> changed <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>changed<span class=\"token punctuation\">)</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>코드를 보면 이 코드가 무엇을 하는지 정확히 알기 어렵습니다.<br>\n<code class=\"language-text\">for-loop</code> 속에 들어있는 <code class=\"language-text\">if/elseif/else</code> 블록들과 플래그를 두고 확인하는 작업은 깔끔해보이지 않습니다.</p>\n<p>따라서, 작성된 코드를 살펴볼 때는 다음과 같은 질문을 해볼 필요가 있습니다.</p>\n<ol>\n<li>코드에 중복된 부분은 없는지?</li>\n<li>코드가 무엇을 하는 것인지 단번에 알 수 있는지?</li>\n<li>코드가 자신이 있어야 할 자리에 있는지?</li>\n<li>변경이 일어난다면, 그 변화에 쉽게 대응할 수 있도록 작성되어 있는지?</li>\n</ol>\n<p>이번 5-1장의 핵심은 위와 같은 질문을 가지고 코드를 리팩토링하는 것입니다.</p>\n<h4 id=\"무엇을-하는지-단번에-알-수-있도록-리팩토링\" style=\"position:relative;\"><a href=\"#%EB%AC%B4%EC%97%87%EC%9D%84-%ED%95%98%EB%8A%94%EC%A7%80-%EB%8B%A8%EB%B2%88%EC%97%90-%EC%95%8C-%EC%88%98-%EC%9E%88%EB%8F%84%EB%A1%9D-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\" aria-label=\"무엇을 하는지 단번에 알 수 있도록 리팩토링 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>무엇을 하는지 단번에 알 수 있도록 리팩토링</h4>\n<p>코드의 전체 로직은 다음과 같이 요약이 가능합니다.</p>\n<ol>\n<li>현재 레벨 확인 후 업그레이드 가능한지 알려주는 로직</li>\n<li>다음 레벨 확인, 설정 로직</li>\n</ol>\n<div class=\"gatsby-code-title\">UserService.java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">// 기본 작업 흐름만 남겨둔 메소드</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users <span class=\"token operator\">=</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user <span class=\"token operator\">:</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 1. 현재 레벨 확인 후 업그레이드 가능한지 알려주는 로직</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 2. 다음 레벨 확인, 설정 로직</span>\n            <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">플래그 설정</code>과 같은 로직이 들어갈 때, 해당 로직을 메소드로 빼기만 하면 플래그를 매번 확인해 작업을 처리하는 로직을 없앨 수 있습니다.</p>\n<p>이제, 해당 메소드가 어떤 작업을 하는지 단번에 이해할 수 있습니다.</p>\n<h4 id=\"숫자의-중복-제거하는-리팩토링\" style=\"position:relative;\"><a href=\"#%EC%88%AB%EC%9E%90%EC%9D%98-%EC%A4%91%EB%B3%B5-%EC%A0%9C%EA%B1%B0%ED%95%98%EB%8A%94-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\" aria-label=\"숫자의 중복 제거하는 리팩토링 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>숫자의 중복 제거하는 리팩토링</h4>\n<p><strong>업그레이드 가능 확인 로직</strong></p>\n<div class=\"gatsby-code-title\">UserService.java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> MIN_LOGCOUNT_FOR_SILVER <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> MIN_RECOMMEND_FOR_GOLD <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Level</span> currentLevel <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>currentLevel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> BASIC<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> MIN_LOGCOUNT_FOR_SILVER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> SILVER<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getRecommend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> MIN_RECOMMEND_FOR_GOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> GOLD<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unknown Level: \"</span> <span class=\"token operator\">+</span> currentLevel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>여러 곳에 중복되어 사용되는 것도 중복이지만, 한 가지 변경 이유가 발생했을 때, 여러 곳을 고치게 만드는 것도 중복입니다.<br>\n따라서, 이러한 숫자들은 <code class=\"language-text\">상수화</code> 시켜 사용하는 것이 좋습니다.  </p>\n<p><code class=\"language-text\">장점</code>은 변경이 일어났을 때 <code class=\"language-text\">상수값만 하나만 변경</code>하면 되고, 숫자가 <code class=\"language-text\">어떤 의미를 가지는지</code>도 파악할 수 있어 가독성에 더 좋습니다.</p>\n<h4 id=\"자신이-있어야-할-자리로-옮기는-리팩토링\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EC%8B%A0%EC%9D%B4-%EC%9E%88%EC%96%B4%EC%95%BC-%ED%95%A0-%EC%9E%90%EB%A6%AC%EB%A1%9C-%EC%98%AE%EA%B8%B0%EB%8A%94-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\" aria-label=\"자신이 있어야 할 자리로 옮기는 리팩토링 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자신이 있어야 할 자리로 옮기는 리팩토링</h4>\n<p><strong>현재 레벨을 파악해 다음 레벨로 업그레이드하는 로직</strong></p>\n<div class=\"gatsby-code-title\">UserService.java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>BASIC<span class=\"token punctuation\">)</span> \n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>SILVER<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>SILVER<span class=\"token punctuation\">)</span>\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Level</span><span class=\"token punctuation\">.</span>GOLD<span class=\"token punctuation\">)</span>\n    userDao<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위 코드의 문제점은 <code class=\"language-text\">다음 단계가 무엇인지 확인하는 로직</code> + <code class=\"language-text\">사용자 Level 필드 변경 로직</code>이 함께 있습니다.  </p>\n<p><code class=\"language-text\">개선 방법</code>은 다음 단계가 무엇인지 확인하는 로직을 <code class=\"language-text\">UserService</code>가 아닌 <code class=\"language-text\">Level</code> 객체에서 확인하면 됩니다.</p>\n<p><strong>Level enum 객체</strong></p>\n<div class=\"gatsby-code-title\">Level.java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">Level</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 다음 단계의 레벨 정보도 함께 추가한다.</span>\n    <span class=\"token function\">GOLD</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">SILVER</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> GOLD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">BASIC</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> SILVER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token comment\">// getter, setter</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>User의 레벨 업그레이드 작업용 메소드</strong></p>\n<div class=\"gatsby-code-title\">User.java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Level</span> nextLevel <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>level<span class=\"token punctuation\">.</span><span class=\"token function\">nextLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextLevel <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>level <span class=\"token operator\">+</span> <span class=\"token string\">\"은 업그레이드가 불가능합니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>level <span class=\"token operator\">=</span> nextLevel<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>간결해진 UserService의 ‘upgradeLevel()’</strong></p>\n<div class=\"gatsby-code-title\">UserService.java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token punctuation\">.</span><span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    userDao<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이제 작업 내용이 명확하게 드러나고 각자 자기 책임에 충실한 작업만 하고 있어 코드를 이해하기 쉬워졌습니다.</p>\n<h4 id=\"레벨업-정책-추상화\" style=\"position:relative;\"><a href=\"#%EB%A0%88%EB%B2%A8%EC%97%85-%EC%A0%95%EC%B1%85-%EC%B6%94%EC%83%81%ED%99%94\" aria-label=\"레벨업 정책 추상화 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>레벨업 정책 추상화</h4>\n<p>더 개선 해보자면, 다음처럼 <code class=\"language-text\">연말 이벤트</code>나, <code class=\"language-text\">새로운 서비스 홍보기간</code> 중에는 레벨업 정책을 다르게 적용할 수 있도록 추상화하는 것도 생각해 볼 수 있습니다.</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserLevelUpgradePolicy</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">boolean</span> <span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"5-2-트랜잭션에서의-서비스-추상화\" style=\"position:relative;\"><a href=\"#5-2-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%97%90%EC%84%9C%EC%9D%98-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B6%94%EC%83%81%ED%99%94\" aria-label=\"5 2 트랜잭션에서의 서비스 추상화 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5-2. 트랜잭션에서의 서비스 추상화</h2>\n<h4 id=\"트랜잭션이란-\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%B4%EB%9E%80-\" aria-label=\"트랜잭션이란  permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션이란 ?</h4>\n<p>더 이상 나눌 수 없는 단위인 작업을 말합니다.  </p>\n<p>작업을 쪼개서 작은 단위로 만들 수 없다는 것은 트랜잭션의 핵심 속성인 <code class=\"language-text\">원자성</code>을 의미합니다.<br>\n따라서, 중간에 예외가 발생해서 작업을 완료할 수 없다면 아예 <code class=\"language-text\">작업이 시작되지 않던 초기 상태</code>로 돌려놔야합니다.</p>\n<div class=\"custom-block info\"><div class=\"custom-block-heading\">추가) 트랜잭션의 특징 - ACID</div><div class=\"custom-block-body\"><p>[1] 원자성 ( Atomicity )<br>\n[2] 일관성 ( Consistency )<br>\n[3] 독립성 ( Isolation )<br>\n[4] 지속성 ( Durability )</p></div></div>\n<h4 id=\"트랜잭션-경계-설정\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B2%BD%EA%B3%84-%EC%84%A4%EC%A0%95\" aria-label=\"트랜잭션 경계 설정 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 경계 설정</h4>\n<p><code class=\"language-text\">DB</code>는 그 자체로 완벽한 트랜잭션을 지원합니다.</p>\n<p>하나의 <code class=\"language-text\">SQL</code> 명령어를 처리하는 경우는 <code class=\"language-text\">DB</code>가 트랜잭션을 보장해준다고 믿을 수 있습니다.<br>\n하지만, <code class=\"language-text\">여러 개의 SQL</code>이 사용되는 작업을 하나의 트랜잭션으로 취급해야 하는 경우가 있습니다.<br>\n(은행 시스템의 계좌 이체 로직)</p>\n<p>문제는 첫번째 작업은 성공했지만 다음 작업이 실패하는 경우입니다.<br>\n이런 경우는 앞에서 처리한 <code class=\"language-text\">SQL</code> 작업도 취소 되어야합니다.</p>\n<p>이런 취소 작업을 <code class=\"language-text\">트랜잭션 롤백</code>(transaction rollback)이라고 합니다.<br>\n또한, 트랜잭션이 성공적으로 마무리되어 <code class=\"language-text\">DB</code>에 반영하는 작업을 <code class=\"language-text\">트랜잭션 커밋</code>(transaction commit)이라고 합니다.</p>\n<h4 id=\"userservice와-userdao의-트랜잭션-문제\" style=\"position:relative;\"><a href=\"#userservice%EC%99%80-userdao%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%AC%B8%EC%A0%9C\" aria-label=\"userservice와 userdao의 트랜잭션 문제 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserService와 UserDao의 트랜잭션 문제</h4>\n<p>데이터 액세스 코드를 DAO로 만들어서 분리해놓았을 경우에는 DAO 메소드를 호출할 때마다 하나의 <code class=\"language-text\">새로운 트랜잭션</code>이 만들어지는 구조가 될 수밖에 없습니다.<br>\nDAO 메소드에서 DB 커넥션을 매번 만들기 때문에 어쩔 수 없이 나타나는 결과입니다.</p>\n<p><strong>여러번 DB에 업데이트를 해야하는 작업을 하나의 트랜잭션으로 묶으려면 ?</strong></p>\n<p><code class=\"language-text\">트랜잭션</code>은 Connection 오브젝트 안에서 만들어지기 때문에 어떤 일련의 작업이 하나의 트랜잭션으로 묶이려면 그 작업이 진행되는 동안 DB 커넥션이 하나만 사용되면 됩니다.</p>\n<p>하지만, 현재는 UserService에서 DB커넥션을 다룰 수 있는 방법이 없습니다.</p>\n<h4 id=\"비즈니스-로직-내의-트랜잭션-경계-설정\" style=\"position:relative;\"><a href=\"#%EB%B9%84%EC%A6%88%EB%8B%88%EC%8A%A4-%EB%A1%9C%EC%A7%81-%EB%82%B4%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B2%BD%EA%B3%84-%EC%84%A4%EC%A0%95\" aria-label=\"비즈니스 로직 내의 트랜잭션 경계 설정 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>비즈니스 로직 내의 트랜잭션 경계 설정</h4>\n<p>UserService와 UserDao를 그대로 둔 채로 트랜잭션을 적용하려면 결국 트랜잭션의 경계설정 작업을 UserService 쪽으로 가져와야 합니다.</p>\n<p><strong>비즈니스 로직 내의 경계 설정</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token comment\">// (1) DB Connection 생성</span>\n    <span class=\"token comment\">// (2) 트랜잭션 시작</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token comment\">// (3) DAO 메소드 호출</span>\n        <span class=\"token comment\">// (4) 트랜잭션 커밋</span>\n    <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// (5) 트랜잭션 롤백</span>\n        <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// (6) DB Connection 종료</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>Connection Object 전달</strong></p>\n<p>UserService에서 만든 Connection 오브젝트를 UserDao에서 사용하려면 DAO 메소드를 호출할 때마다 Connection 오브젝트를 파라미터로 전달해줘야 합니다.</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> c<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> c<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> c<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 Connection 오브젝트를 전달해서 사용하면 UserService의 ‘upgradeLevels()’ 안에서 시작한 트랜잭션에 UserDao의 메소드들도 참여하게 할 수 있습니다.</p>\n<h4 id=\"userservice-트랜잭션-경계설정의-문제점\" style=\"position:relative;\"><a href=\"#userservice-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B2%BD%EA%B3%84%EC%84%A4%EC%A0%95%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"userservice 트랜잭션 경계설정의 문제점 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserService 트랜잭션 경계설정의 문제점</h4>\n<ol>\n<li>DB 커넥션을 비롯한 리소스의 깔끔한 처리를 가능하게 했던 <code class=\"language-text\">JdbcTemplate</code>을 더 이상 활용할 수 없음</li>\n<li>DAO의 메소드와 비즈니스 로직을 담고 있는 UserService의 메소드에 Connection <code class=\"language-text\">파라미터가 추가</code>돼야 함</li>\n<li>Connection 파라미터가 UserDao 인터페이스 메소드에 추가되면 UserDao는 더 이상 <code class=\"language-text\">데이터 액세스 기술</code>에 독립적일 수가 없다는 점<br>\nJPA나 하이버네이트로 UserDao의 구현 방식을 변경하려고 하면 Connection 대신 EntityManager나 Session 오브젝트를 UserDao 메소드가 전달받도록 해야 합니다.</li>\n<li>DAO 메소드에 Connection 파라미터를 받게 하면 <code class=\"language-text\">테스트 코드</code>에도 영향을 줌</li>\n</ol>\n<h2 id=\"트랜잭션-동기화\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%8F%99%EA%B8%B0%ED%99%94\" aria-label=\"트랜잭션 동기화 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 동기화</h2>\n<p><strong>비즈니스 로직에서 트랜잭션 경계를 설정하려면 어떻게 해야할까?</strong></p>\n<p>스프링은 이 문제를 해결할 수 있는 멋진 방법을 제공해줍니다.</p>\n<h4 id=\"connection-파라미터-제거\" style=\"position:relative;\"><a href=\"#connection-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0-%EC%A0%9C%EA%B1%B0\" aria-label=\"connection 파라미터 제거 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connection 파라미터 제거</h4>\n<p>파라미터를 제거하기 위해 스프링이 제안하는 방법은 <code class=\"language-text\">트랜잭션 동기화</code>(transaction synchronization) 방식입니다.</p>\n<p><code class=\"language-text\">트랜잭션 동기화</code>란 UserService에서 트랜잭션을 시작하기 위해 만든 Connection 오브젝트를 특별한 저장소에 보관해두고, 이후에 호출되는 DAO의 메소드에서는 저장된 Connection을 가져다가 사용하게 하는 것입니다.</p>\n<p><code class=\"language-text\">트랜잭션 동기화 저장소</code>는 <code class=\"language-text\">작업 스레드마다 독립적</code>으로 Connection 오브젝트를 저장하고 관리하기 때문에 다중 사용자를 처리하는 서버의 멀티스레드 환경에서도 충돌이 날 염려는 없습니다.</p>\n<h4 id=\"트랜잭션-동기화-적용\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%8F%99%EA%B8%B0%ED%99%94-%EC%A0%81%EC%9A%A9\" aria-label=\"트랜잭션 동기화 적용 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 동기화 적용</h4>\n<p>스프링은 JdbcTemplate과 더불어 이런 트랜잭션 동기화 기능을 지원하는 간단한 유틸리티 메소드를 제공하고 있다.</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">DataSource</span> dataSource<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 트랜잭션 동기화 관리자를 이용해 동기화 작업을 초기화</span>\n        <span class=\"token class-name\">TransactionSynchronizationManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">initSynchronization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// DB 커넥션을 생성하고 트랜잭션을 시작</span>\n        <span class=\"token comment\">// 이후의 DAO 작업은 모두 여기서 시작한 트랜잭션 안에서 진행</span>\n        <span class=\"token class-name\">Connection</span> c <span class=\"token operator\">=</span> <span class=\"token class-name\">DataSourceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        c<span class=\"token punctuation\">.</span><span class=\"token function\">setAutoCommit</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users <span class=\"token operator\">=</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user <span class=\"token operator\">:</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">upgradeUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            c<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            c<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 예외가 발생하면 롤백</span>\n            <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 스프링 유틸리티 메소드를 이용해 DB 커넥션을 안전하게 닫는다.</span>\n            <span class=\"token class-name\">DataSourceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">releaseConnection</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// 동기화 작업 종료 및 정리</span>\n            <span class=\"token class-name\">TransactionSynchronizationManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">unbindResource</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">TransactionSynchronizationManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">clearSynchronization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>스프링이 제공하는 유틸리티 메소드를 쓰는 이유?</strong></p>\n<p>DataSource에서 Connection을 직접 가져오지 않고, 스프링이 제공하는 유틸리티 메소드를 쓰는 이유는 <code class=\"language-text\">DataSourceUtils</code>의 getConnection() 메소드는 <code class=\"language-text\">Connection 오브젝트를 생성</code>해줄 뿐만 아니라 트랜잭션 동기화에 사용하도록 <code class=\"language-text\">저장소에 바인딩</code>해주기 때문에 사용합니다.</p>\n<p><strong>만약 여러 개의 DB에 접근하고 싶다면?</strong></p>\n<p>한 개 이상의 DB로의 작업을 하나의 트랜잭션으로 만드는 것은 JDBC의 Connection을 이용한 트랜잭션 방식인 로컬 트랜잭션으로는 불가능합니다.<br>\n따라서, 별도의 트랜잭션 관리자를 통해 <code class=\"language-text\">글로벌 트랜잭션</code> 방식을 사용해야합니다.</p>\n<blockquote>\n<p>자바에서는 글로벌 트랜잭션 매니저인 <code class=\"language-text\">JTA</code>를 제공 !!</p>\n</blockquote>\n<h2 id=\"기술과-환경에-종속되는-트랜잭션\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EC%88%A0%EA%B3%BC-%ED%99%98%EA%B2%BD%EC%97%90-%EC%A2%85%EC%86%8D%EB%90%98%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\" aria-label=\"기술과 환경에 종속되는 트랜잭션 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기술과 환경에 종속되는 트랜잭션</h2>\n<p>또 다른 새로운 문제는 <code class=\"language-text\">하이버네이트</code>를 이용한 트랜잭션 관리 코드는 <code class=\"language-text\">JDBC</code>나 <code class=\"language-text\">JTA</code>의 코드와는 또 다르다는 것입니다.<br>\n<code class=\"language-text\">하이버네이트</code>는 Connection을 직접 사용하지 않고 <code class=\"language-text\">Session</code>이라는 것을 사용하고, 독자적인 트랜잭션 관리 API를 사용합니다.</p>\n<h4 id=\"스프링의-트랜잭션-서비스-추상화\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B6%94%EC%83%81%ED%99%94\" aria-label=\"스프링의 트랜잭션 서비스 추상화 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링의 트랜잭션 서비스 추상화</h4>\n<p>스프링은 트랜잭션 기술의 공통점을 담은 트랜잭션 추상화 기술을 제공합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.297872340425535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACa0lEQVQ4y2VS2W7TUBD1r4KKyvKGBKgt8IgAiQeQUEGikLaIQinwgCpekIoKqIikpSp1XOIkzh47thNn8Xa9HOZepwviSkdnZs6c8Z2bSDhz0iknU26OPTwslJH7XcfyYR1P9zXBfhwLfeK6KKkq6o0G2p0OtFoNErjI2AlSgUhMtychPqk6vtRMbGkmPld72KaYsUTozPNgtFoY9HpwTBOWrtNA26ZPTYDxGCmBx+lwgKRbBTgMDdAriNuqYJ6n3QoSoy48CMPTCwUBDRwO/1/ZriDceoDw2yLC70/A8qtgu6+IV7La9iPix0DsY+KHYl2dbjmhG0up44hBaZJk4AOtKtjXRRrymoa8BCvQsMJalvP4J31gZ4nvDNfz0aa1DcOg5Sb/3vD00BuFtE5AWjASHLvOmZzA3DM7nR4p6Q8QkT+OYnoOjkgw478VIYxSAT9MTuKIazymvkD0R4ioOSJBUneOIO81UdytQyYU9zKWCzUovxpUr4lYJlZIO8xrgnmde4pTj/BRn9Q7qqPT7KPbsNCqWeg0bIoz6K0+5ZaIuXZcMzsO/V0GIud6m2tNW3gljOitvCDD2AfcYAqPcJz7U81HbDsITQuR3aeam+lc8zKf5EUjDAMDo7CHvmeIeBj04LEhXDYQ8SjINMfXsa/8wEFxDwdKHk1TxZhZ6LuZn/dKa3+u4rk8g1xxlvgCVpTLWJLPY7l4CW9K1/Ds8JzQcvJFrCpX8EKZwUZ5Du/K89P6rPDzfg7pY/UO3qrUoC5gQ53H+/JtrJdu4APxpnaXhl6n+gINuClq65RvavcJ90R/5psj3y3R8xdbwbJLqGukUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"스프링의 트랜잭션 추상화 계층\"\n        title=\"스프링의 트랜잭션 추상화 계층\"\n        src=\"/static/2b0e6eead0d8de6fb10314f6a56a58e4/1d69c/transaction-abstraction.png\"\n        srcset=\"/static/2b0e6eead0d8de6fb10314f6a56a58e4/4dcb9/transaction-abstraction.png 188w,\n/static/2b0e6eead0d8de6fb10314f6a56a58e4/5ff7e/transaction-abstraction.png 375w,\n/static/2b0e6eead0d8de6fb10314f6a56a58e4/1d69c/transaction-abstraction.png 750w,\n/static/2b0e6eead0d8de6fb10314f6a56a58e4/b2cef/transaction-abstraction.png 847w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>출처 : <a href=\"https://yangbongsoo.gitbooks.io\">https://yangbongsoo.gitbooks.io</a></p>\n<h4 id=\"트랜잭션-서비스-추상화-적용\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B6%94%EC%83%81%ED%99%94-%EC%A0%81%EC%9A%A9\" aria-label=\"트랜잭션 서비스 추상화 적용 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 서비스 추상화 적용</h4>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PlatformTransactionManager</span> transactionManager<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">upgradeLevels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">TransactionStatus</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">getTransaction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultTransactionDefinition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> users <span class=\"token operator\">=</span> userDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user <span class=\"token operator\">:</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">canUpgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">upgradeLevel</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">RuntimeException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            transactionManager<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<ul>\n<li>비즈니스 로직을 담은 코드는 데이터 액세스 로직 코드와 분리되어야 함</li>\n<li>DAO를 사용하는 비즈니스 로직에는 단위 작업을 보장해주는 트랜잭션이 필요</li>\n<li>스프링이 제공하는 트랜잭션 동기화 기법, 트랜잭션 추상화 기법을 활용</li>\n</ul>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>다음은 포스트에서는 <code class=\"language-text\">단일 책임 원칙</code>과 <code class=\"language-text\">테스트를 위한 서비스 추상화</code>에 대해 알아보겠습니다.</p>","tableOfContents":"<ul>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EA%B0%9C%EC%9A%94\">개요</a></li>\n<li>\n<p><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#5-1-%EB%B9%84%EC%A6%88%EB%8B%88%EC%8A%A4-%EB%A1%9C%EC%A7%81\">5-1. 비즈니스 로직</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EB%AC%B4%EC%97%87%EC%9D%84-%ED%95%98%EB%8A%94%EC%A7%80-%EB%8B%A8%EB%B2%88%EC%97%90-%EC%95%8C-%EC%88%98-%EC%9E%88%EB%8F%84%EB%A1%9D-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\">무엇을 하는지 단번에 알 수 있도록 리팩토링</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EC%88%AB%EC%9E%90%EC%9D%98-%EC%A4%91%EB%B3%B5-%EC%A0%9C%EA%B1%B0%ED%95%98%EB%8A%94-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\">숫자의 중복 제거하는 리팩토링</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EC%9E%90%EC%8B%A0%EC%9D%B4-%EC%9E%88%EC%96%B4%EC%95%BC-%ED%95%A0-%EC%9E%90%EB%A6%AC%EB%A1%9C-%EC%98%AE%EA%B8%B0%EB%8A%94-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\">자신이 있어야 할 자리로 옮기는 리팩토링</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EB%A0%88%EB%B2%A8%EC%97%85-%EC%A0%95%EC%B1%85-%EC%B6%94%EC%83%81%ED%99%94\">레벨업 정책 추상화</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#5-2-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%97%90%EC%84%9C%EC%9D%98-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B6%94%EC%83%81%ED%99%94\">5-2. 트랜잭션에서의 서비스 추상화</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%B4%EB%9E%80-\">트랜잭션이란 ?</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B2%BD%EA%B3%84-%EC%84%A4%EC%A0%95\">트랜잭션 경계 설정</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#userservice%EC%99%80-userdao%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%AC%B8%EC%A0%9C\">UserService와 UserDao의 트랜잭션 문제</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EB%B9%84%EC%A6%88%EB%8B%88%EC%8A%A4-%EB%A1%9C%EC%A7%81-%EB%82%B4%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B2%BD%EA%B3%84-%EC%84%A4%EC%A0%95\">비즈니스 로직 내의 트랜잭션 경계 설정</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#userservice-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B2%BD%EA%B3%84%EC%84%A4%EC%A0%95%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90\">UserService 트랜잭션 경계설정의 문제점</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%8F%99%EA%B8%B0%ED%99%94\">트랜잭션 동기화</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#connection-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0-%EC%A0%9C%EA%B1%B0\">Connection 파라미터 제거</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%8F%99%EA%B8%B0%ED%99%94-%EC%A0%81%EC%9A%A9\">트랜잭션 동기화 적용</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EA%B8%B0%EC%88%A0%EA%B3%BC-%ED%99%98%EA%B2%BD%EC%97%90-%EC%A2%85%EC%86%8D%EB%90%98%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\">기술과 환경에 종속되는 트랜잭션</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EC%8A%A4%ED%94%84%EB%A7%81%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B6%94%EC%83%81%ED%99%94\">스프링의 트랜잭션 서비스 추상화</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B6%94%EC%83%81%ED%99%94-%EC%A0%81%EC%9A%A9\">트랜잭션 서비스 추상화 적용</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EC%A0%95%EB%A6%AC\">정리</a></li>\n<li><a href=\"/category/spring/toby-spring/service-abstraction/transaction/#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></li>\n</ul>","frontmatter":{"title":"[토비의 스프링] 5-1. 서비스 추상화와 트랜잭션","description":"Spring 서비스 추상화하기","date":"2020.07.01","emoji":"🔮","category":"spring"}}},"pageContext":{"slug":"/category/spring/toby-spring/service-abstraction/transaction/","relatedPosts":[{"node":{"fields":{"slug":"/category/spring/toby-spring/spring-core-technology/"},"frontmatter":{"title":"[토비의 스프링] 7. 스프링 핵심 기술의 응용","date":"2020.07.24","emoji":"🌟","category":"spring"}}},{"node":{"fields":{"slug":"/category/spring/toby-spring/aop/transaction-property/"},"frontmatter":{"title":"[토비의 스프링] 6-3. AOP - 트랜잭션 속성","date":"2020.07.20","emoji":"🧩","category":"spring"}}},{"node":{"fields":{"slug":"/category/spring/toby-spring/aop/basic-concept/"},"frontmatter":{"title":"[토비의 스프링] 6-2. AOP - 기본 용어","date":"2020.07.16","emoji":"📙","category":"spring"}}},{"node":{"fields":{"slug":"/category/spring/toby-spring/aop/unit-test-and-proxy/"},"frontmatter":{"title":"[토비의 스프링] 6-1. AOP - 단위 테스트와 프록시","date":"2020.07.11","emoji":"ℹ️","category":"spring"}}},{"node":{"fields":{"slug":"/category/spring/toby-spring/service-abstraction/mockup-test/"},"frontmatter":{"title":"[토비의 스프링] 5-2. 단일 책임 원칙과 테스트 추상화","date":"2020.07.07","emoji":"⚠️","category":"spring"}}}]}}}