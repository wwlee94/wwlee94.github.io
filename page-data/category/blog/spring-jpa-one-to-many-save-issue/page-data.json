{"componentChunkName":"component---src-templates-post-tsx","path":"/category/blog/spring-jpa-one-to-many-save-issue/","result":{"data":{"site":{"siteMetadata":{"title":"Blausee 기술 블로그","author":"wwlee94","siteUrl":"https://wwlee94.github.io"}},"markdownRemark":{"id":"177373df-2dc1-5150-9d1c-2457548e3e22","excerpt":"개요  ‘Party-ing’ 프로젝트를 진행하던 도중  관계를 가지는 엔티티를 Save 할 때 2개의 테이블에 데이터는 잘 생성되었으나 Save 쿼리문 뿐 아니라 Update…","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h2>\n<p><code class=\"language-text\">루비콘 2기</code> ‘Party-ing’ 프로젝트를 진행하던 도중 <code class=\"language-text\">1:N</code> 관계를 가지는 엔티티를 Save 할 때 2개의 테이블에 데이터는 잘 생성되었으나 Save 쿼리문 뿐 아니라 Update 쿼리문이 추가로 발생되는 이슈를 경험해서 해결 방법을 공유하고자 합니다.</p>\n<h2 id=\"현재-이슈-발생-상황\" style=\"position:relative;\"><a href=\"#%ED%98%84%EC%9E%AC-%EC%9D%B4%EC%8A%88-%EB%B0%9C%EC%83%9D-%EC%83%81%ED%99%A9\" aria-label=\"현재 이슈 발생 상황 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>현재 이슈 발생 상황</h2>\n<p>엔티티 정보는 다음과 같습니다.</p>\n<p><strong>Review 엔티티</strong></p>\n<ul>\n<li>reviewer 유저가 target 유저에게 리뷰를 남겼다는 정보를 가지는 관계 엔티티</li>\n</ul>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Review</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> reviewId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"reviewerId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> reviewer<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"targetId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span>ALL<span class=\"token punctuation\">,</span> orphanRemoval <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"reviewId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Rating</span><span class=\"token punctuation\">></span></span> rating<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Review</span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> reviewer<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span> target<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Rating</span><span class=\"token punctuation\">></span></span> rating<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Review</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">reviewer</span><span class=\"token punctuation\">(</span>reviewer<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">target</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">rating</span><span class=\"token punctuation\">(</span>rating<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>Rating 엔티티</strong></p>\n<ul>\n<li>하나의 리뷰 내용을 가지고 있는 엔티티</li>\n</ul>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Rating</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> ratingId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">45</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Enumerated</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EnumType</span><span class=\"token punctuation\">.</span>STRING<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Content</span> content<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Rating</span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Content</span> content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Rating</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>실행되는 서비스 코드</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">/**\n* 특정 사용자에게 리뷰하기\n* @param reviewerId : 리뷰 하는 사용자 ID (현재 사용자)\n* @param targetId : 리뷰 할 사용자 ID\n* @param reviewDto : 리뷰 내용 DTO\n*/</span>\n<span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">review</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> reviewerId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> targetId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ReviewRequest</span> reviewDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">User</span> reviewer <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>reviewerId<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserNotFoundException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">User</span> target <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>targetId<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserNotFoundException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Review</span><span class=\"token punctuation\">></span></span> optional <span class=\"token operator\">=</span> reviewQueryRepository<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span>reviewerId<span class=\"token punctuation\">,</span> targetId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>optional<span class=\"token punctuation\">.</span><span class=\"token function\">isPresent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReviewDuplicatedException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Review</span> review <span class=\"token operator\">=</span> <span class=\"token class-name\">Review</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>reviewer<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Rating</span><span class=\"token punctuation\">></span></span> ratingList <span class=\"token operator\">=</span> reviewDto<span class=\"token punctuation\">.</span><span class=\"token function\">getRatingList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ratingList<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>rating <span class=\"token operator\">-></span> review<span class=\"token punctuation\">.</span><span class=\"token function\">getRating</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>rating<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    reviewRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>review<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"실행-결과\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%96%89-%EA%B2%B0%EA%B3%BC\" aria-label=\"실행 결과 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실행 결과</h4>\n<p>API 콜을 보내서 위의 서비스 코드를 실행시키면 다음과 같은 쿼리문이 발생합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d653b8466fa6bebcebde2c55461eec3d/d9b5d/api-call.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.255319148936174%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVQoz61S2XKDMAzkY1oOY2OMD86Q4wWm//8/W0kJmUw7een0YdHo9K5Q1jQNbrcblmXB9XrFuq6CGCPyPEdRFCjL8hc4zvmfyEIIMqDve0zTJJjnGeM4ylDnHKy1aNtW7Dsc+exyuWDbtucgZrlvO/b9Ds4neiymHsMwyMMH2D9wxDKWzNBaI/gA5zt8qgK1quE6hw+Vo9E1lqmHMpUw8d4L6rqWXraelFrKZUyTZXMipSRsjG0kxrJd8DiPCV+nHufkpKmnuq7rRCKzs9QbTQ1DpDJmxnsSpsagpSJdaylqaTBbR82KGBtiwmysve/LUH2gPXOvVSVUVSGr6MOJ1tFiY4IfJpiGCsmm9Qo/zmiIVZxPd38YaaiiP12gqsqnrVRFjz4GatpRIjkxUmPqaD8sv0MagvghWFoF+558R3lDkjV8Z16gJZYdNyXgu3vc3uttvfpH/h2E4bvj/QueDP9r4Dc1K1SYXly9gwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"API 콜\"\n        title=\"API 콜\"\n        src=\"/static/d653b8466fa6bebcebde2c55461eec3d/1d69c/api-call.png\"\n        srcset=\"/static/d653b8466fa6bebcebde2c55461eec3d/4dcb9/api-call.png 188w,\n/static/d653b8466fa6bebcebde2c55461eec3d/5ff7e/api-call.png 375w,\n/static/d653b8466fa6bebcebde2c55461eec3d/1d69c/api-call.png 750w,\n/static/d653b8466fa6bebcebde2c55461eec3d/78797/api-call.png 1125w,\n/static/d653b8466fa6bebcebde2c55461eec3d/d9b5d/api-call.png 1224w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f7cd821b8b49940c93bc482a933483ca/2cefc/issue.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.42553191489361%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABPUlEQVQoz1VR23aDMAzjjwpbKXcoJCFcBi0t69n//4hmZaWjDzmyFVuWE68oS4zjiKZpYK2FUgrGGHRd55C81trlvCNu+cZtPOu9OElgpGBrJNZ17S5LGXY6nRBFEdI0RSK1cRy7nMic8T73qqrCsixuwjzPGIbBHcZ0zAGbYw7s+/7NIeM3h1meOwGSFCDZtu1LbHOXS93miDG5LMvcIc+cG3lpkqIVESXNRVEgPB53a0VIditm0kTM838h3vFZwjD8W1mZFvd1hRFXvTht+TGyxiAfZST+miaHlutJTSRNiYjx7Sni+z4Oh8MLvUnVeEwj+nOFqzWYtJLT4NJqzEY7bhZu6Sy6skAtrqvjB4KnSBAEb8e7lRm+2Sz4sBqXqsCqa5dfzwXu6uy4pa6Ey/HTW6xlik9fBJ8ie+FfIIkXHm7wqUEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"issue\"\n        title=\"issue\"\n        src=\"/static/f7cd821b8b49940c93bc482a933483ca/1d69c/issue.png\"\n        srcset=\"/static/f7cd821b8b49940c93bc482a933483ca/4dcb9/issue.png 188w,\n/static/f7cd821b8b49940c93bc482a933483ca/5ff7e/issue.png 375w,\n/static/f7cd821b8b49940c93bc482a933483ca/1d69c/issue.png 750w,\n/static/f7cd821b8b49940c93bc482a933483ca/78797/issue.png 1125w,\n/static/f7cd821b8b49940c93bc482a933483ca/2cefc/issue.png 1400w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>DB 테이블 정보를 보면 결과는 정상적으로 동작하는 것을 확인할 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c7bda0a1909fa38cb2e0d1848aaeb6e6/41870/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.51063829787234%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABpUlEQVQoz42SaW7bMBCFeSFrMap9sfaNFK1YcougcVrHvv8VXoaSnThBnebHh9k4A3DesFxskcsRJZfoH0aI7UB2h37Ykf+AVkjI3R58GCGpPox79LsJj89HHF7OeDqecDieiROmxycwSc2Smrt+i6oTKLseXA7kc+R1i5oGtlRLyc+qGlXLUbYdCopLetPwHo3oUXOBounA0jRBUVZIsxxeGCIuKmTkJ0kKP4qxKWvkeQHP82AYBkzTfMcw59wVlWO6rkPTNOiXpK58YnmkLzG9MQzz47A7MF1bzU0aWW21ujQbd/iqtsCiNEOc5gtZAT+MYNk2LMeBfcGyydqLnWszt76NH9aSYz//nDEdXjD+/ov98wntMM3KqmWrJZeEEqUUAy1+uQSu1KccV9dAsUKS8g31MS4EhNyiIcVqUq8mW1TNrHBFJ9WSejkJE8QJwk2CmMSKNooEEfnxDSrHXNeBHwQI6Kvq7obpF3zfpy9YcIKQ/ACO68JQuyX0L1B1dg2UQmoHjuthvV5/GPAddd9Uvg2uAz7f2+2d/XfgvYf/yn9n6CsPw5beE8wTlQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DB 결과\"\n        title=\"DB 결과\"\n        src=\"/static/c7bda0a1909fa38cb2e0d1848aaeb6e6/1d69c/result.png\"\n        srcset=\"/static/c7bda0a1909fa38cb2e0d1848aaeb6e6/4dcb9/result.png 188w,\n/static/c7bda0a1909fa38cb2e0d1848aaeb6e6/5ff7e/result.png 375w,\n/static/c7bda0a1909fa38cb2e0d1848aaeb6e6/1d69c/result.png 750w,\n/static/c7bda0a1909fa38cb2e0d1848aaeb6e6/78797/result.png 1125w,\n/static/c7bda0a1909fa38cb2e0d1848aaeb6e6/aa440/result.png 1500w,\n/static/c7bda0a1909fa38cb2e0d1848aaeb6e6/41870/result.png 1788w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Insert 쿼리 작업만으로 테이블을 생성할 수 있음에도 왜 Update 쿼리가 추가로 발생하는지 의아했습니다.</p>\n<p>그것도 Insert 쿼리와 Update 쿼리문의 개수도 각각 2개씩으로 동일했습니다.</p>\n<p><code class=\"language-text\">&#39;결과만 잘 동작하면 되지 않나?&#39;</code></p>\n<p>라며 가볍게 넘길 수는 없는 문제라고 생각합니다.</p>\n<p>왜냐하면, DB에 요청하는 쿼리가 결국엔 2배가 되었다는 소리이고 기존 성능에서 2배로 감소했다는 의미이기 때문입니다.</p>\n<h2 id=\"발생-원인\" style=\"position:relative;\"><a href=\"#%EB%B0%9C%EC%83%9D-%EC%9B%90%EC%9D%B8\" aria-label=\"발생 원인 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>발생 원인?</h2>\n<p>그렇다면 위와 같은 이슈가 발생되는 원인은 뭘까?</p>\n<p>이러한 이유는 <code class=\"language-text\">1:N</code> 관계가 <code class=\"language-text\">단방향</code>이기 때문입니다.</p>\n<p><code class=\"language-text\">Rating</code> 엔티티에 <code class=\"language-text\">reviewId</code> 컬럼이 추가되기는 했지만, 단방향이기 때문에 <code class=\"language-text\">Rating</code>은 <code class=\"language-text\">Review</code>의 존재를 모릅니다.</p>\n<p>그래서 개별 행 단위로는 <code class=\"language-text\">reviewId</code>가 없는 채로 <code class=\"language-text\">Rating</code> 테이블에 Insert되고 먼저 DB에 저장된 이후 Update를 통해서 <code class=\"language-text\">reviewId</code>를 추가합니다.</p>\n<h2 id=\"그렇다면-해결-방법은\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%A0%87%EB%8B%A4%EB%A9%B4-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95%EC%9D%80\" aria-label=\"그렇다면 해결 방법은 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그렇다면 해결 방법은?</h2>\n<p>RDB와 동일한 동작을 원한다면 JPA 엔티티 간의 관계를 <code class=\"language-text\">1:N 단방향</code> 매핑이 아닌 <code class=\"language-text\">1:N 양방향</code> 매핑으로 변경시켜야합니다.</p>\n<p><strong>Review 엔티티</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Review</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> reviewId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"reviewerId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> reviewer<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"targetId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// mappedBy 추가, 조인 컬럼 삭제</span>\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"review\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span>ALL<span class=\"token punctuation\">,</span> orphanRemoval <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Rating</span><span class=\"token punctuation\">></span></span> rating<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Review</span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> reviewer<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span> target<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Rating</span><span class=\"token punctuation\">></span></span> rating<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Review</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">reviewer</span><span class=\"token punctuation\">(</span>reviewer<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">target</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">rating</span><span class=\"token punctuation\">(</span>rating<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>Rating 엔티티</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Rating</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> ratingId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">45</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Enumerated</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EnumType</span><span class=\"token punctuation\">.</span>STRING<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Content</span> content<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Rating 엔티티에 Review 필드를 추가 (양방향 연결)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"reviewId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Review</span> review<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 수정</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Rating</span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Content</span> content<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Review</span> review<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> \n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Rating</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">review</span><span class=\"token punctuation\">(</span>review<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>실행되는 서비스 코드</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token comment\">/**\n* 특정 사용자에게 리뷰하기\n* @param reviewerId : 리뷰 하는 사용자 ID (현재 사용자)\n* @param targetId : 리뷰 할 사용자 ID\n* @param reviewDto : 리뷰 내용 DTO\n*/</span>\n<span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">review</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> reviewerId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> targetId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ReviewRequest</span> reviewDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">User</span> reviewer <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>reviewerId<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserNotFoundException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">User</span> target <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>targetId<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserNotFoundException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Review</span><span class=\"token punctuation\">></span></span> optional <span class=\"token operator\">=</span> reviewQueryRepository<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span>reviewerId<span class=\"token punctuation\">,</span> targetId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>optional<span class=\"token punctuation\">.</span><span class=\"token function\">isPresent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReviewDuplicatedException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Review</span> review <span class=\"token operator\">=</span> <span class=\"token class-name\">Review</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>reviewer<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Rating</span><span class=\"token punctuation\">></span></span> ratingList <span class=\"token operator\">=</span> reviewDto<span class=\"token punctuation\">.</span><span class=\"token function\">getRatingList</span><span class=\"token punctuation\">(</span>review<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 수정</span>\n    ratingList<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>rating <span class=\"token operator\">-></span> review<span class=\"token punctuation\">.</span><span class=\"token function\">getRating</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>rating<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    reviewRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>review<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"실행-결과-1\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%96%89-%EA%B2%B0%EA%B3%BC-1\" aria-label=\"실행 결과 1 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실행 결과</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0db50347a22a8795f5973150e1a350fe/2cefc/solution.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.57446808510639%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABM0lEQVQozz1QW3KDMBDjQoWmkwkvvzA2JgRC0namvf9FVK0n9EOzXq1Wll30SiHGCGMMvPe5DsMA59x/L1VwcDIfxxGBe4dWejkXfd9j2zaklLCuK67XK5ZlyZimCV3XZVOBtTYva61zL2fFQOJxaArFoRiGELJZZBXzRDOpIgq8XRJIOnlNTkedXHgkFF7mRd22ObrjIMQJXpZl6cXVTYtL06Bl0o5Jap6Fa9oODTnhW3o05CVt4Y3G7+cTDz5xS7yx75AGh2ANRs4C4ciNWmXo+pI5mXvFp9LkMJWvKHbTY58TZgqWwWLikmB2BpNRWINHooHg5l3W5Rk17nKGrt5QVhUqoixLFF9O4+e+YqP4mSJW1jtNHlMkAr6XGTdnc93jiOeLj6qDPX9kw/fTCacX/gAvuvVdyzXrngAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"해결 결과\"\n        title=\"해결 결과\"\n        src=\"/static/0db50347a22a8795f5973150e1a350fe/1d69c/solution.png\"\n        srcset=\"/static/0db50347a22a8795f5973150e1a350fe/4dcb9/solution.png 188w,\n/static/0db50347a22a8795f5973150e1a350fe/5ff7e/solution.png 375w,\n/static/0db50347a22a8795f5973150e1a350fe/1d69c/solution.png 750w,\n/static/0db50347a22a8795f5973150e1a350fe/78797/solution.png 1125w,\n/static/0db50347a22a8795f5973150e1a350fe/2cefc/solution.png 1400w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p><code class=\"language-text\">1:N 단방향</code> 매핑은 설정도 간편하고 직관적이지만, Update가 오버헤드로 작용합니다.</p>\n<p><code class=\"language-text\">@OneToMany</code>만 붙히는 <code class=\"language-text\">1:N 단방향</code> 조인 테이블 방식과 <code class=\"language-text\">@JoinColum</code>만 붙히는 <code class=\"language-text\">1:N 단방향</code> 조인 컬럼 방식 모두 피해야합니다.</p>\n<p>따라서, 1:N에서 N이 큰 상황 또는 모든 상황에서 오버헤드가 없는 <code class=\"language-text\">1:N 양방향</code> 매핑을 사용하는게 성능에 좋을 것 같습니다 !</p>","tableOfContents":"<ul>\n<li><a href=\"/category/blog/spring-jpa-one-to-many-save-issue/#%EA%B0%9C%EC%9A%94\">개요</a></li>\n<li>\n<p><a href=\"/category/blog/spring-jpa-one-to-many-save-issue/#%ED%98%84%EC%9E%AC-%EC%9D%B4%EC%8A%88-%EB%B0%9C%EC%83%9D-%EC%83%81%ED%99%A9\">현재 이슈 발생 상황</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/spring-jpa-one-to-many-save-issue/#%EC%8B%A4%ED%96%89-%EA%B2%B0%EA%B3%BC\">실행 결과</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/category/blog/spring-jpa-one-to-many-save-issue/#%EB%B0%9C%EC%83%9D-%EC%9B%90%EC%9D%B8\">발생 원인?</a></li>\n<li>\n<p><a href=\"/category/blog/spring-jpa-one-to-many-save-issue/#%EA%B7%B8%EB%A0%87%EB%8B%A4%EB%A9%B4-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95%EC%9D%80\">그렇다면 해결 방법은?</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/spring-jpa-one-to-many-save-issue/#%EC%8B%A4%ED%96%89-%EA%B2%B0%EA%B3%BC-1\">실행 결과</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/category/blog/spring-jpa-one-to-many-save-issue/#%EA%B2%B0%EB%A1%A0\">결론</a></li>\n</ul>","frontmatter":{"title":"[Spring JPA] 1:N 관계 엔티티 save시 update 쿼리가 추가로 발생하는 이슈","description":"","date":"2020.09.25","emoji":"💭","category":"blog"}}},"pageContext":{"slug":"/category/blog/spring-jpa-one-to-many-save-issue/","relatedPosts":[{"node":{"fields":{"slug":"/category/blog/spring/redis/spring-data-redis-version-issue/"},"frontmatter":{"title":"[Spring Redis] Spring Boot 2.3.2.RELEASE 버전 Redis 이슈","date":"2020.11.20","emoji":"🚀","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/spring-transactional-precautions/"},"frontmatter":{"title":"[Spring] @Transactional 사용 시 주의점과 JPQL 주의점","date":"2020.11.14","emoji":"🚧","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/aws-eb-deploy/"},"frontmatter":{"title":"[AWS EB] AWS Elastic Beanstalk로 서버 배포 하기","date":"2020.09.02","emoji":"🚀","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/http-post-redirect-to-get/"},"frontmatter":{"title":"왜 리다이렉트시 HTTP 메소드들은 GET 메서드로 리다이렉션 될까?","date":"2020.08.27","emoji":"❔","category":"blog"}}}]}}}