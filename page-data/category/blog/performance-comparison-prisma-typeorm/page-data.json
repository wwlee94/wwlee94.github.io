{"componentChunkName":"component---src-templates-post-tsx","path":"/category/blog/performance-comparison-prisma-typeorm/","webpackCompilationHash":"32baafdbd3392368b93d","result":{"data":{"site":{"siteMetadata":{"title":"Blausee 기술 블로그","author":"wwlee94","siteUrl":"https://wwlee94.github.io"}},"markdownRemark":{"id":"4443f20c-6eec-5b14-b6a2-907546f54c44","excerpt":"개요 최근 Prography 라는 IT 대외동아리 모임에 참여하여 프로젝트를 런타임과 를 사용하여 개발을 진행했습니다. 같은 팀원과 의견을 나누면서 팀 개발에는 보다 언어가 적합하다고 생각해 채택했고 (Object-relatinal mapping…","html":"<h2>개요</h2>\n<p>최근 <a href=\"http://prography.org/\">Prography</a> 라는 IT 대외동아리 모임에 참여하여 프로젝트를 <code class=\"language-text\">NodeJS</code>런타임과 <code class=\"language-text\">Express</code>를 사용하여 개발을 진행했습니다.</p>\n<p>같은 팀원과 의견을 나누면서 팀 개발에는 <code class=\"language-text\">JavaScript</code>보다 <code class=\"language-text\">TypeScript</code>언어가 적합하다고 생각해 채택했고<br>\n<code class=\"language-text\">ORM</code>(Object-relatinal mapping)은 <code class=\"language-text\">Prisma</code>와 <code class=\"language-text\">TypeORM</code>를 고민하던 중 아래와 같은 이유로 <code class=\"language-text\">Prisma</code>를 채택했습니다. (Prisma2 버전)</p>\n<ol>\n<li>Node.js 와 TypeScript 를 위한 Auto-generated &#x26; Type-safe 한 <code class=\"language-text\">Querybuilder</code>를 제공해준다.</li>\n<li>\n<p>DB 마이그레이션, 덤프, 데이터 제어를 위한 CRUD 형태의 API 기능 제공</p>\n<ul>\n<li><code class=\"language-text\">schema.prisma</code> 데이터 모델 파일을 수정해 데이터 모델과 DB 마이그레이션을 자동으로 수행 가능</li>\n</ul>\n</li>\n<li><code class=\"language-text\">Prisma Studio</code> 라는 GUI Database Tool 제공</li>\n</ol>\n<h2>베타 버전의 한계 ?</h2>\n<p>위와 같은 이유로 <code class=\"language-text\">Prisma</code>를 채택하여 개발을 진행했지만 다음과 같은 여러 베타 버전의 문제점을 마주했습니다 😭</p>\n<ol>\n<li>\n<p><a href=\"https://github.com/prisma/prisma-client-js/issues/710\">Multi-field primary ID 이슈</a></p>\n<blockquote>\n<p>현재 이슈 등록 후 해결 완료 !</p>\n</blockquote>\n</li>\n<li>\n<p><a href=\"https://github.com/prisma/prisma/issues/1984\">Prisma Fluent API의 성능에 대한 의문</a></p>\n<blockquote>\n<p>Fluent API로 쿼리를 날리면 쿼리문이 Join되지 않고 여러 쿼리로 분리되서 호출됨 (DB 요청 비용 증가)</p>\n</blockquote>\n</li>\n<li>\n<p>환경 별 설정 분리의 불편함</p>\n<blockquote>\n<p>Prisma migrate 기능의 Default PATH가 prisma/.env 경로로 고정되어 있다 (변경 불가 😂)</p>\n</blockquote>\n<p>따라서, dotenv cli를 사용해 <code class=\"language-text\">.env</code>파일을 직접 지정해 주어야하는 불편함 (너무 불편..)</p>\n</li>\n</ol>\n<h2>Prisma 와 TypeORM 성능 비교</h2>\n<div class=\"custom-block info\"><div class=\"custom-block-heading\">조건 </div><div class=\"custom-block-body\"><p>서로 다른 DB 두개를 생성해 각각 총 10000개의 posts 데이터를 생성하여 테스트를 진행했습니다.\n개인적으로 진행한 테스트이기 때문에 오차가 발생할 수 있습니다.</p></div></div>\n<h4>모델링</h4>\n<h5>1. Prisma Model</h5>\n<div class=\"gatsby-code-title\">Prisma-Model</div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\">model Post <span class=\"token punctuation\">{</span>\n  id        Int     <span class=\"token directive function\">@id</span> <span class=\"token directive function\">@default</span><span class=\"token punctuation\">(</span>autoincrement<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  title     String\n  author    User?   <span class=\"token directive function\">@relation</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>authorId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">references</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  authorId  Int?\n<span class=\"token punctuation\">}</span>\n\nmodel User <span class=\"token punctuation\">{</span>\n  id    Int     <span class=\"token directive function\">@id</span> <span class=\"token directive function\">@default</span><span class=\"token punctuation\">(</span>autoincrement<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  email String  <span class=\"token directive function\">@unique</span>\n  name  String?\n  posts Post<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5>2. TypeORM Model</h5>\n<div class=\"gatsby-code-title\">TypeORM-Model</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">@<span class=\"token function\">Entity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">PrimaryGeneratedColumn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  id<span class=\"token operator\">!</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n  @<span class=\"token function\">Column</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  title<span class=\"token operator\">!</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  @<span class=\"token function\">Column</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  authorId<span class=\"token operator\">!</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  @<span class=\"token function\">ManyToOne</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">type</span></span> <span class=\"token operator\">=></span> User<span class=\"token punctuation\">,</span> <span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> user<span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">)</span>\n  author<span class=\"token operator\">!</span><span class=\"token punctuation\">:</span> User<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n@<span class=\"token function\">Entity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">PrimaryGeneratedColumn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  id<span class=\"token operator\">!</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n  @<span class=\"token function\">Column</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  email<span class=\"token operator\">!</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  @<span class=\"token function\">Column</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  name<span class=\"token operator\">!</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  @<span class=\"token function\">OneToMany</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">type</span></span> <span class=\"token operator\">=></span> Post<span class=\"token punctuation\">,</span> <span class=\"token parameter\">post</span> <span class=\"token operator\">=></span> post<span class=\"token punctuation\">.</span>author<span class=\"token punctuation\">)</span>\n  posts<span class=\"token operator\">!</span><span class=\"token punctuation\">:</span> Post<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>테스트</h4>\n<h5>1. Prisma 코드</h5>\n<div class=\"gatsby-code-title\">Prisma2</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'------- Prisma2 -------'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token string\">'prisma'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">findMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  include<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> posts<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">timeEnd</span><span class=\"token punctuation\">(</span><span class=\"token string\">'prisma'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h5>결과</h5>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 700px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.741058655221746%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0UlEQVQY02WO3XLCIBSE8y7+1L+OCAmEQEISNMbU6rR64fT932N7cjpTL7zY4Zxll49kbT/gTw+0/Td02SMPA0QeIbKAd2GxIaWmhtQVRFpiqzxkVrGvyN9Kx55I/5SI5g4VLuj6K/bHC75uP4iHM1zoYIoIbRuUNYH8Hn48XYQPR4aEOMDQ7mgvqg5Vc0KibITxB+iiZVKWN0jzmoPatvygMoHlqMR3BBp/PM5SB1jqc48gyXC+oSbS8Hnn0ORNYL5SmC3li6aL3f/8zCjyn5lfhF+FQfMJzGoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Prisma\"\n        title=\"Prisma\"\n        src=\"/static/19cde4ff3bb19808d8a43a1209fac263/a8200/prisma-test.png\"\n        srcset=\"/static/19cde4ff3bb19808d8a43a1209fac263/52d5c/prisma-test.png 175w,\n/static/19cde4ff3bb19808d8a43a1209fac263/1bae2/prisma-test.png 350w,\n/static/19cde4ff3bb19808d8a43a1209fac263/a8200/prisma-test.png 700w,\n/static/19cde4ff3bb19808d8a43a1209fac263/0ab52/prisma-test.png 1050w,\n/static/19cde4ff3bb19808d8a43a1209fac263/9d4f3/prisma-test.png 1398w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n      />\n    </span></p>\n<h5>2. TypeORM 코드</h5>\n<div class=\"gatsby-code-title\">TypeORM</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">createConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">connection</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'------- TypeORM -------'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> repository <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">getRepository</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token string\">'typeorm'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> users2 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> repository<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>relations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">timeEnd</span><span class=\"token punctuation\">(</span><span class=\"token string\">'typeorm'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h5>결과</h5>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 700px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.51246537396122%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAsUlEQVQI1z2MWw6CMBRE2YyPoPEBbXhoQVopKIiiMX64/3UcaxP9mNwzk5sTRHLPJrcUpxfq0BKlmqU4kKkamVY+6d4QZ4ZtasiKBplpvye5Rrh9kxh2hSVOSoKvZHi82dV3KnulbO7Up5F+eBKpjlxfsO0VpTu2rq+Km/+rjj3NeUSZHln2tI5LfSawDobxhXWSzknWUU64SpgtBJNQuCuZhfG/TxfC89TxfCl9ftuXPyDKZlM66uWDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TypeORM\"\n        title=\"TypeORM\"\n        src=\"/static/744da7732dd0d8cd396c9022d78405f5/a8200/typeorm-test.png\"\n        srcset=\"/static/744da7732dd0d8cd396c9022d78405f5/52d5c/typeorm-test.png 175w,\n/static/744da7732dd0d8cd396c9022d78405f5/1bae2/typeorm-test.png 350w,\n/static/744da7732dd0d8cd396c9022d78405f5/a8200/typeorm-test.png 700w,\n/static/744da7732dd0d8cd396c9022d78405f5/0ab52/typeorm-test.png 1050w,\n/static/744da7732dd0d8cd396c9022d78405f5/fa92b/typeorm-test.png 1400w,\n/static/744da7732dd0d8cd396c9022d78405f5/232f1/typeorm-test.png 1444w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n      />\n    </span></p>\n<h2>결론</h2>\n<p>Prisma (180-240ms), TypeORM (90-120ms) 여러번 실행해보니 대략적인 결과가 나왔습니다.</p>\n<p>시간 차이가 나는 이유는 아무래도 <code class=\"language-text\">Prisma</code>는 쿼리를 2번 나누어 보내고, <code class=\"language-text\">TypeORM</code>은 Join 시킨 1번의 쿼리로 보내서 차이가 생기는 것 같습니다.</p>\n<p>Prisma가 Optimize가 잘 안되어 있는 건지..?</p>\n<p>확실치 않지만 아무래도 베타 버전이기에 사용을 고민하는 개발자분이 있다면 깊게 고민하시고 기술을 선택하셨으면 합니다 !</p>","frontmatter":{"title":"Prisma와 TypeORM은 성능에 어떤 차이가 있을까?","description":"Prisma와 TypeORM 쿼리 성능 비교","date":"2020.06.09","emoji":"⁉️","category":"blog"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/category/blog/performance-comparison-prisma-typeorm/","relatedPosts":[{"node":{"fields":{"slug":"/category/blog/getting-started-utterances/"},"frontmatter":{"title":"Gatsby 블로그 - utterances 소셜 댓글 기능 도입하기","date":"2020.06.07","emoji":"💬","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/getting-started-markdown/"},"frontmatter":{"title":"마크다운 (Markdown) 문법 알아보기","date":"2020.06.04","emoji":"📋","category":"blog"}}}]}}}