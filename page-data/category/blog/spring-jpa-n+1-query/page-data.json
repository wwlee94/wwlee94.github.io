{"componentChunkName":"component---src-templates-post-tsx","path":"/category/blog/spring-jpa-n+1-query/","result":{"data":{"site":{"siteMetadata":{"title":"Blausee 기술 블로그","author":"wwlee94","siteUrl":"https://wwlee94.github.io"}},"markdownRemark":{"id":"dead7296-852a-5b0d-b270-74c9f8fad902","excerpt":"개요 평소 Spring 프로젝트를 개발하며 1:N 관계를 갖는 엔티티 클래스를 작성할때 아무런 의심없이 를 쉽게 사용했습니다. 그러던 중, 스프링 스터디에서 N+1 쿼리 문제에 대한 이야기가 나왔고 개인 프로젝트에서 확인해 봤더니 1:N…","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h2>\n<p>평소 Spring 프로젝트를 개발하며 1:N 관계를 갖는 엔티티 클래스를 작성할때 아무런 의심없이 <code class=\"language-text\">JPA</code>를 쉽게 사용했습니다.<br>\n그러던 중, 스프링 스터디에서 N+1 쿼리 문제에 대한 이야기가 나왔고 개인 프로젝트에서 확인해 봤더니</p>\n<p><strong>1:N 관계를 갖는 엔티티의 하위 엔티티를 조회할 때마다 엄청난 쿼리가 발생하고 있었습니다</strong></p>\n<p>이번 포스팅에서는 <code class=\"language-text\">Spring JPA</code>를 사용하다보면 쉽게 마주할 수 있는 <code class=\"language-text\">N+1 쿼리</code>에 대해 원인과 해결 방법에 대해서 알아보고<br>\n<code class=\"language-text\">N+1 쿼리</code> 원인에 대해서 설명하면서 <code class=\"language-text\">JPA</code>의 글로벌 패치 전략인 <code class=\"language-text\">LAZY</code> 방식과 <code class=\"language-text\">EAGER</code> 방식이 어떻게 다르게 동작하는지도 함께 알아보겠습니다.</p>\n<h2 id=\"n1-쿼리-문제는-언제-발생할까-\" style=\"position:relative;\"><a href=\"#n1-%EC%BF%BC%EB%A6%AC-%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%96%B8%EC%A0%9C-%EB%B0%9C%EC%83%9D%ED%95%A0%EA%B9%8C-\" aria-label=\"n1 쿼리 문제는 언제 발생할까  permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>N+1 쿼리 문제는 언제 발생할까 ?</h2>\n<p>발생하는 경우는 다음과 같은 2가지 경우가 있습니다.</p>\n<p>두 개의 엔티티가 <code class=\"language-text\">1:N</code> 관계를 가지며 <code class=\"language-text\">JPQL</code>로 객체를 조회할 때</p>\n<ol>\n<li><code class=\"language-text\">EAGER</code> 전략으로 데이터를 가져오는 경우</li>\n<li><code class=\"language-text\">LAZY</code> 전략으로 데이터를 가져온 이후에 가져온 데이터에서 하위 엔티티를 다시 조회하는 경우</li>\n</ol>\n<p>예제를 통해 살펴봅시다 !</p>\n<div class=\"custom-block info\"><div class=\"custom-block-heading\">JPQL이란 ?</div><div class=\"custom-block-body\"><p>JPQL이란 플랫폼에 독립적인 객체지향 쿼리 언어입니다.<br>\n자바 코드에서 데이터베이스를 조회할 때 특정 SQL이나 저장 엔진에 종속되지 않게 도와줍니다.</p></div></div>\n<h2 id=\"n1-쿼리-예제\" style=\"position:relative;\"><a href=\"#n1-%EC%BF%BC%EB%A6%AC-%EC%98%88%EC%A0%9C\" aria-label=\"n1 쿼리 예제 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>N+1 쿼리 예제</h2>\n<h4 id=\"엔티티-모델링\" style=\"position:relative;\"><a href=\"#%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%AA%A8%EB%8D%B8%EB%A7%81\" aria-label=\"엔티티 모델링 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>엔티티 모델링</h4>\n<p><strong>Album Model</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Album</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> albumTitle<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> locales<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// @OneToMany(mappedBy = \"album\", cascade = CascadeType.ALL, fetch = FetchType.EAGER) // 2번 상황</span>\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"album\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span>ALL<span class=\"token punctuation\">,</span> fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1번 상황</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Song</span><span class=\"token punctuation\">></span></span> songs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>Song Model</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Song</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> track<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> length<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"album_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Album</span> album<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"하위-엔티티를-조회하지-않는-경우\" style=\"position:relative;\"><a href=\"#%ED%95%98%EC%9C%84-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"하위 엔티티를 조회하지 않는 경우 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하위 엔티티를 조회하지 않는 경우</h4>\n<p><strong>Album의 Song에 접근하지 않은 경우</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> N1_쿼리테스트<span class=\"token function\">_1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Album</span><span class=\"token punctuation\">></span></span> albums <span class=\"token operator\">=</span> albumRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"lazy-방식-결과\" style=\"position:relative;\"><a href=\"#lazy-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC\" aria-label=\"lazy 방식 결과 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LAZY 방식 결과</h4>\n<p>하위 엔티티에 접근하지 않았기 때문에 <code class=\"language-text\">Album</code>만 가져오는 것을 볼 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 2.2857142857142856%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAP0lEQVQI1x2J2wkAQQgDrygXdVd8gP23lEM/AjOTz8zw3sM5B92NcXffTb/3QlWRmevTiQgRgaqCiCzPx8z4AUogIfEqUBzIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"LAZY 방식\"\n        title=\"LAZY 방식\"\n        src=\"/static/5ededfa60eaa01b673c0709e2d89c049/8c557/lazy_1.png\"\n        srcset=\"/static/5ededfa60eaa01b673c0709e2d89c049/4edbd/lazy_1.png 175w,\n/static/5ededfa60eaa01b673c0709e2d89c049/13ae7/lazy_1.png 350w,\n/static/5ededfa60eaa01b673c0709e2d89c049/8c557/lazy_1.png 700w,\n/static/5ededfa60eaa01b673c0709e2d89c049/e996b/lazy_1.png 1050w,\n/static/5ededfa60eaa01b673c0709e2d89c049/2cefc/lazy_1.png 1400w,\n/static/5ededfa60eaa01b673c0709e2d89c049/f238d/lazy_1.png 2078w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h4 id=\"eager-방식-결과\" style=\"position:relative;\"><a href=\"#eager-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC\" aria-label=\"eager 방식 결과 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EAGER 방식 결과</h4>\n<p><strong>N+1 발생 !</strong></p>\n<p><code class=\"language-text\">JPQL</code>에서 동작한 쿼리를 통해서 <code class=\"language-text\">Album</code>에 데이터를 조회합니다.<br>\n그 이후 <code class=\"language-text\">JPA</code>에서는 글로벌 패치 전략(<code class=\"language-text\">Eager</code>로딩)을 보고 <code class=\"language-text\">Album</code>의 <code class=\"language-text\">Song</code> 대해서 추가적인 로딩 작업을 진행해 <code class=\"language-text\">N+1 문제</code>를 발생시킵니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.142857142857142%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAc0lEQVQY01WPSQ7AMAgD+VRO2bf/P4lqkFy1h8jjYAixtZaPMbz37l8+54TKt9ZC55zBtdao4TlwSskNo4a9dwwVo3iaNZBGuJQSrBxK3QANZSs8wXvvL6ijLANhesijPGzaTgGKYn0LD2tTfM75fYB76QPtVIs53/n24QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"EAGER 방식\"\n        title=\"EAGER 방식\"\n        src=\"/static/ed00f430126589211d379f6a7759143d/8c557/eager_1.png\"\n        srcset=\"/static/ed00f430126589211d379f6a7759143d/4edbd/eager_1.png 175w,\n/static/ed00f430126589211d379f6a7759143d/13ae7/eager_1.png 350w,\n/static/ed00f430126589211d379f6a7759143d/8c557/eager_1.png 700w,\n/static/ed00f430126589211d379f6a7759143d/e996b/eager_1.png 1050w,\n/static/ed00f430126589211d379f6a7759143d/2cefc/eager_1.png 1400w,\n/static/ed00f430126589211d379f6a7759143d/5b2ff/eager_1.png 2190w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"하위-엔티티를-조회하는-경우\" style=\"position:relative;\"><a href=\"#%ED%95%98%EC%9C%84-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"하위 엔티티를 조회하는 경우 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하위 엔티티를 조회하는 경우</h2>\n<p><code class=\"language-text\">Lazy</code> 로딩을 하기 위해서는 해당 <code class=\"language-text\">Entity</code> 가 영속 상태여야 합니다.<br>\n보통 <code class=\"language-text\">Repository</code> 에서 리스트로 가져오면 영속이 끊긴 상태로 가져오기 때문에 <code class=\"language-text\">Lazy</code> 전략 테스팅 시 <code class=\"language-text\">@Transactional</code> 꼭 사용해야합니다 !</p>\n<p><code class=\"language-text\">@Transactional</code>을 사용하지 않으면 다음과 같은 에러가 발생합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.428571428571427%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzklEQVQY0zWP0W6DMAxF+ZwVCF1jB0IIVG0nVaMtZRv//yt3N9n6cGTLsY9uisv7ATdr8UluVnJ/PdhcZ+0wuIhRBwQJOGmL2XucRXDc79GaBmIMHJG6JgZF3zT4EsWmDncKH/LHpoqVs8V5LBTfxeHhWpynCdM4Ig4DYgjwzqGhzFRVpvAUrv/Cmale0h/VLN3Yr6wffY8TiTHiSGnHpJb7FSVvux3Kssxk4ZNH3zx6fTtJU+o0W1Ji1mvb4UJhSMnISHGqjm/CnZopk/AXn1CEbHXpJBkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"프록시 에러\"\n        title=\"프록시 에러\"\n        src=\"/static/922868e893bb9f17fc4d75c22953f61c/8c557/proxy_error.png\"\n        srcset=\"/static/922868e893bb9f17fc4d75c22953f61c/4edbd/proxy_error.png 175w,\n/static/922868e893bb9f17fc4d75c22953f61c/13ae7/proxy_error.png 350w,\n/static/922868e893bb9f17fc4d75c22953f61c/8c557/proxy_error.png 700w,\n/static/922868e893bb9f17fc4d75c22953f61c/e996b/proxy_error.png 1050w,\n/static/922868e893bb9f17fc4d75c22953f61c/2cefc/proxy_error.png 1400w,\n/static/922868e893bb9f17fc4d75c22953f61c/42267/proxy_error.png 2670w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><strong>Album의 Song에 접근하는 경우</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token annotation punctuation\">@Transactional</span> <span class=\"token comment\">// 테스팅에서 LAZY 전략시 필수</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> N1_쿼리테스트<span class=\"token function\">_2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Album</span><span class=\"token punctuation\">></span></span> albums <span class=\"token operator\">=</span> albumRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Album</span> album <span class=\"token operator\">:</span> albums<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>album<span class=\"token punctuation\">.</span><span class=\"token function\">getSongs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Song에 접근 !</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"lazy-방식-결과-1\" style=\"position:relative;\"><a href=\"#lazy-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC-1\" aria-label=\"lazy 방식 결과 1 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LAZY 방식 결과</h4>\n<p><strong>N+1 발생 !</strong></p>\n<p>처음엔 <code class=\"language-text\">Album</code> 리스트만 조회했지만 <code class=\"language-text\">Album</code> 엔티티에서 하위 엔티티인 <code class=\"language-text\">Song</code> 엔티티로 접근했기 때문에 Lazy 로딩이 일어나면서 <code class=\"language-text\">N+1 문제</code> 발생\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.57142857142858%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAz0lEQVQoz2WRWQ6DQAxDuRI7Yh1A4v43CnqWXKXth5VlEo+TVOd5RikljuOI67pi3/dYlkUxFqzrGvM8y9+2TT4gD8jx1jRNVJBBBMF93ypo2zaGYfiyXdcJfd8rphmfd/JYYhFmlQBSlPIzoNBkJoCUeBzHjyUvQgABY0zTpCZbF2bSTPinkDFR6P15JI9qgjyyCf1hVlpBwpi/No+eD4APmfeaFWpklKES+zyPfF+aIgj4HbAGYJXO5RVJoXfIAUjWda0GLumLGo6pscpsXx14CZCWTADAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"LAZY 방식2\"\n        title=\"LAZY 방식2\"\n        src=\"/static/a862e7a46a9b1e5d0c728276a25b79ec/8c557/lazy_2.png\"\n        srcset=\"/static/a862e7a46a9b1e5d0c728276a25b79ec/4edbd/lazy_2.png 175w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/13ae7/lazy_2.png 350w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/8c557/lazy_2.png 700w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/e996b/lazy_2.png 1050w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/2cefc/lazy_2.png 1400w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/a7115/lazy_2.png 2186w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h4 id=\"eager-방식-결과-1\" style=\"position:relative;\"><a href=\"#eager-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC-1\" aria-label=\"eager 방식 결과 1 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EAGER 방식 결과</h4>\n<p><strong>N+1 발생 !</strong></p>\n<p><code class=\"language-text\">하위 엔티티를 조회하지 않는 경우</code>의 <code class=\"language-text\">Eager</code> 방식 결과와 동일하게 <code class=\"language-text\">N+1 문제</code>가 발생하는 것을 볼 수 있습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.857142857142854%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0UlEQVQoz42QR46GUAyD33XobQGid+5/ooy+SEb/LKYsLJsQJ34J8zzbOI62bZsty2LTNLmmjuafetZ1dR6GwXEch3360WHfd2+8rssbpGnQPy07z9MZI/w8j/eg5QlqkFma+qdZyZUaaAE1eYK2s4EiA0hKjQVi1XUK+L7vb+np8ydT5KPveyvL0oqisKqqXKdpakmSvPwXgm7Utq0PyvPcIR3HsUVR5PwfBB2f2F3X+eCmaTyhuK7rFyTF+GNC3q6bMYwBJMuy7AVDBEy/DfwCSPIIOm/eojAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"EAGER 방식2\"\n        title=\"EAGER 방식2\"\n        src=\"/static/988b3b4ebe7eff963353b86df5d09744/8c557/eager_2.png\"\n        srcset=\"/static/988b3b4ebe7eff963353b86df5d09744/4edbd/eager_2.png 175w,\n/static/988b3b4ebe7eff963353b86df5d09744/13ae7/eager_2.png 350w,\n/static/988b3b4ebe7eff963353b86df5d09744/8c557/eager_2.png 700w,\n/static/988b3b4ebe7eff963353b86df5d09744/e996b/eager_2.png 1050w,\n/static/988b3b4ebe7eff963353b86df5d09744/2cefc/eager_2.png 1400w,\n/static/988b3b4ebe7eff963353b86df5d09744/a7115/eager_2.png 2186w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"해결-방법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"해결 방법 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방법</h2>\n<p>미리 쿼리로 테이블을 조인해서 가져오기 때문에 <code class=\"language-text\">Lazy</code>, <code class=\"language-text\">Eager</code> 두개의 전략에 해당되는 해결법입니다.</p>\n<h4 id=\"1-패치-조인fetch-join\" style=\"position:relative;\"><a href=\"#1-%ED%8C%A8%EC%B9%98-%EC%A1%B0%EC%9D%B8fetch-join\" aria-label=\"1 패치 조인fetch join permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 패치 조인(Fetch Join)</h4>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select DISTINCT a from Album a join fetch a.songs\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Album</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllJoinFetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token annotation punctuation\">@Transactional</span> <span class=\"token comment\">// 테스팅에서 LAZY 전략시 사용해야 동작</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> fetchJoin테스트<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Album</span><span class=\"token punctuation\">></span></span> albums <span class=\"token operator\">=</span> albumRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllJoinFetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Album</span> album <span class=\"token operator\">:</span> albums<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>album<span class=\"token punctuation\">.</span><span class=\"token function\">getSongs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Song에 접근 !</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.71428571428572%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAApklEQVQY03WQWQrEIBBEPU42s5kI2TT7/W9UQzUokwzz8WhL8dmt8t5jXVewEuccpmlCXdfoug7GmAdt26Lve1hrBe6FzLValgXbtmHfdxHO84xhGETYNE2UlGWJNE0jSZI8ckAF0XmeIqOoKAporUUSYM7zXM4CzG8Uu6OM9TiOOPI4jjIKO+TohJ2GzDUfybLsV3jfN67rEiG/gJeqqvrbxTdv4QfuL59816Kg7AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"패치 조인\"\n        title=\"패치 조인\"\n        src=\"/static/e260f1257d155697e8d5ae436886459b/8c557/fetch_join.png\"\n        srcset=\"/static/e260f1257d155697e8d5ae436886459b/4edbd/fetch_join.png 175w,\n/static/e260f1257d155697e8d5ae436886459b/13ae7/fetch_join.png 350w,\n/static/e260f1257d155697e8d5ae436886459b/8c557/fetch_join.png 700w,\n/static/e260f1257d155697e8d5ae436886459b/e996b/fetch_join.png 1050w,\n/static/e260f1257d155697e8d5ae436886459b/2cefc/fetch_join.png 1400w,\n/static/e260f1257d155697e8d5ae436886459b/bcec6/fetch_join.png 1834w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>패치 조인의 단점은 2가지가 있습니다.</p>\n<ol>\n<li><code class=\"language-text\">JPA</code>가 제공하는 <code class=\"language-text\">Pagable</code> 기능 사용 불가 (페이징 API)</li>\n<li>\n<p><code class=\"language-text\">1:N</code> 관계가 2개인 엔티티를 패치 조인 사용 불가</p>\n<blockquote>\n<p>임시 해결법은 <code class=\"language-text\">List -&gt; Set</code>으로 변경하는 것</p>\n</blockquote>\n</li>\n</ol>\n<h4 id=\"2-batch-size-조절\" style=\"position:relative;\"><a href=\"#2-batch-size-%EC%A1%B0%EC%A0%88\" aria-label=\"2 batch size 조절 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Batch Size 조절</h4>\n<p>설정한 <code class=\"language-text\">Size</code>만큼 데이터를 미리 로딩합니다. (<code class=\"language-text\">where in</code>을 사용하여)<br>\n<code class=\"language-text\">JPA</code>의 페이징 API 기능과 함께 사용할 때 유용하게 사용 가능할 듯 합니다.</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@BatchSize</span><span class=\"token punctuation\">(</span>size <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"album\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span>ALL<span class=\"token punctuation\">,</span> fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>EAGER<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Song</span><span class=\"token punctuation\">></span></span> songs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>Spring JPA의 N+1 문제에 대해 알아보고, 발생하는 경우와 해결 방법에 대해서 알아보았습니다.</p>\n<p>긴글 봐주셔서 감사합니다. 🙇🏻‍♂️</p>","tableOfContents":"<ul>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#%EA%B0%9C%EC%9A%94\">개요</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#n1-%EC%BF%BC%EB%A6%AC-%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%96%B8%EC%A0%9C-%EB%B0%9C%EC%83%9D%ED%95%A0%EA%B9%8C-\">N+1 쿼리 문제는 언제 발생할까 ?</a></li>\n<li>\n<p><a href=\"/category/blog/spring-jpa-n+1-query/#n1-%EC%BF%BC%EB%A6%AC-%EC%98%88%EC%A0%9C\">N+1 쿼리 예제</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%AA%A8%EB%8D%B8%EB%A7%81\">엔티티 모델링</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#%ED%95%98%EC%9C%84-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94-%EA%B2%BD%EC%9A%B0\">하위 엔티티를 조회하지 않는 경우</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#lazy-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC\">LAZY 방식 결과</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#eager-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC\">EAGER 방식 결과</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/blog/spring-jpa-n+1-query/#%ED%95%98%EC%9C%84-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\">하위 엔티티를 조회하는 경우</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#lazy-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC-1\">LAZY 방식 결과</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#eager-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC-1\">EAGER 방식 결과</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/blog/spring-jpa-n+1-query/#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\">해결 방법</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#1-%ED%8C%A8%EC%B9%98-%EC%A1%B0%EC%9D%B8fetch-join\">1. 패치 조인(Fetch Join)</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#2-batch-size-%EC%A1%B0%EC%A0%88\">2. Batch Size 조절</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></li>\n</ul>","frontmatter":{"title":"Spring JPA(ORM)의 N+1 쿼리 문제 해결","description":"Spring JPA N+1 쿼리 문제에 대해서","date":"2020.06.29","emoji":"✅","category":"blog"}}},"pageContext":{"slug":"/category/blog/spring-jpa-n+1-query/","relatedPosts":[{"node":{"fields":{"slug":"/category/blog/about-multi-thread-env/"},"frontmatter":{"title":"멀티 스레드 환경의 자원 공유에 대하여","date":"2020.06.16","emoji":"🏘","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/performance-comparison-prisma-typeorm/"},"frontmatter":{"title":"Prisma와 TypeORM은 성능에 차이가 있을까?","date":"2020.06.11","emoji":"⁉️","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/getting-started-utterances/"},"frontmatter":{"title":"Gatsby 블로그 - utterances 소셜 댓글 기능 도입하기","date":"2020.06.07","emoji":"💬","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/getting-started-markdown/"},"frontmatter":{"title":"마크다운 (Markdown) 문법 알아보기","date":"2020.06.04","emoji":"📋","category":"blog"}}}]}}}