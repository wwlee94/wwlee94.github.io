{"componentChunkName":"component---src-templates-post-tsx","path":"/category/blog/spring-jpa-n+1-query/","result":{"data":{"site":{"siteMetadata":{"title":"Blausee 기술 블로그","author":"wwlee94","siteUrl":"https://wwlee94.github.io"}},"markdownRemark":{"id":"dead7296-852a-5b0d-b270-74c9f8fad902","excerpt":"개요 평소 Spring 프로젝트를 개발하며 1:N 관계를 갖는 엔티티 클래스를 작성할때 아무런 의심없이 JPA를 쉽게 사용했습니다. 그러던 중, 스프링 스터디에서  문제에 대한 이야기가 나왔고 개인 프로젝트에서 확인해 봤더니 1:N…","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h2>\n<p>평소 Spring 프로젝트를 개발하며 1:N 관계를 갖는 엔티티 클래스를 작성할때 아무런 의심없이 JPA를 쉽게 사용했습니다.<br>\n그러던 중, 스프링 스터디에서 <code class=\"language-text\">N+1 쿼리</code> 문제에 대한 이야기가 나왔고 개인 프로젝트에서 확인해 봤더니</p>\n<p><strong>1:N 관계를 갖는 엔티티의 하위 엔티티를 조회할 때마다 엄청난 쿼리가 발생하고 있었습니다</strong></p>\n<p>이번 포스팅에서는 Spring JPA를 사용하다보면 쉽게 마주할 수 있는 <code class=\"language-text\">N+1 쿼리</code>에 대해 원인과 해결 방법에 대해서 알아보고<br>\n<code class=\"language-text\">N+1 쿼리</code> 문제의 원인에 대해서 설명하면서 <code class=\"language-text\">JPA</code>의 글로벌 패치 전략인 <code class=\"language-text\">LAZY</code> 방식과 <code class=\"language-text\">EAGER</code> 방식이 어떻게 다르게 동작하는지도 함께 알아보겠습니다.</p>\n<h2 id=\"n1-쿼리-문제의-원인-\" style=\"position:relative;\"><a href=\"#n1-%EC%BF%BC%EB%A6%AC-%EB%AC%B8%EC%A0%9C%EC%9D%98-%EC%9B%90%EC%9D%B8-\" aria-label=\"n1 쿼리 문제의 원인  permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>N+1 쿼리 문제의 원인 ?</h2>\n<p><code class=\"language-text\">Spring Data JPA</code>에서 제공하는 Repository의 ‘findAll()’, ‘findById()’ 등과 같은 메소드를 사용하면 바로 DB에 SQL 쿼리를 날리는 것이 아닙니다.</p>\n<blockquote>\n<p>참조 : <a href=\"https://www.inflearn.com/questions/6187\">findAll() vs findById() 내부 동작 차이</a></p>\n</blockquote>\n<p><code class=\"language-text\">JPQL</code>이라는 객체지향 쿼리 언어를 생성, 실행시킨 후 JPA는 이것을 분석해서 SQL을 생성, 실행하는 동작에서 <code class=\"language-text\">N+1 쿼리</code> 문제가 발생합니다.</p>\n<p><code class=\"language-text\">JPQL</code> 입장에서는 <code class=\"language-text\">LAZY</code> 로딩, <code class=\"language-text\">EAGER</code> 로딩과 같은 글로벌 패치 전략을 신경쓰지 않고 <code class=\"language-text\">JPQL</code>만 사용해서 <code class=\"language-text\">SQL</code>을 생성합니다.</p>\n<div class=\"custom-block info\"><div class=\"custom-block-heading\">JPQL이란 ?</div><div class=\"custom-block-body\"><p>JPQL이란 플랫폼에 독립적인 객체지향 쿼리 언어입니다.<br>\n자바 코드에서 데이터베이스를 조회할 때 특정 SQL이나 저장 엔진에 종속되지 않게 도와줍니다.</p></div></div>\n<h2 id=\"n1-쿼리-문제는-언제-발생할까-\" style=\"position:relative;\"><a href=\"#n1-%EC%BF%BC%EB%A6%AC-%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%96%B8%EC%A0%9C-%EB%B0%9C%EC%83%9D%ED%95%A0%EA%B9%8C-\" aria-label=\"n1 쿼리 문제는 언제 발생할까  permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>N+1 쿼리 문제는 언제 발생할까 ?</h2>\n<p>발생하는 경우는 다음과 같은 2가지 경우가 있습니다.</p>\n<p>두 개의 엔티티가 <code class=\"language-text\">1:N</code> 관계를 가지며 <code class=\"language-text\">JPQL</code>로 객체를 조회할 때</p>\n<ol>\n<li><code class=\"language-text\">EAGER</code> 전략으로 데이터를 가져오는 경우</li>\n<li><code class=\"language-text\">LAZY</code> 전략으로 데이터를 가져온 이후에 가져온 데이터에서 하위 엔티티를 다시 조회하는 경우</li>\n</ol>\n<p>예제를 통해 살펴봅시다 !</p>\n<h2 id=\"엔티티-모델링\" style=\"position:relative;\"><a href=\"#%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%AA%A8%EB%8D%B8%EB%A7%81\" aria-label=\"엔티티 모델링 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>엔티티 모델링</h2>\n<p><code class=\"language-text\">1:N</code> 관계를 만들기 위해 <strong>하나의 앨범(Album)</strong>이 <strong>많은 노래(Song)</strong>를 가질 수 있도록 엔티티를 생성하고 관계를 연결시키겠습니다.</p>\n<p><strong>Album Model</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Album</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> albumTitle<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> locales<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// @OneToMany(mappedBy = \"album\", cascade = CascadeType.ALL, fetch = FetchType.EAGER) // 2번 상황</span>\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"album\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span>ALL<span class=\"token punctuation\">,</span> fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1번 상황</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Song</span><span class=\"token punctuation\">></span></span> songs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>Song Model</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Song</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> track<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> length<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"album_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Album</span> album<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>Database Diagram</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/edc7bac8cfa06e0f2289847ddb81ed08/d53ff/diagram.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.61702127659575%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrklEQVQoz31Sa1PaUBDN/zEvwiM1kSTEkCdINEBwRASmFmtDA9XgtNPxr5/uvdhxUMcPO3vn3nPP7p6zQq1Ww2ehquq7rCgKj4+wwv5R5gB28TZeP2hQZBlty0LSHyCKE3QcB7Ztw6FsmuaesOsHCKMYPmWbwAxgvWRd1yHLMv4XlWQFXhBhejNDRKQe+0vEca8Pp+NCJZwwynOk2Rh+lMA59eB6XXSDEH4Y8aqtlg79iwHDcqG1DJxfZHh+/oviZ4nN9hceqgpPv/8gn0wgSRKEzabA426H+2KNdVmi3G7xWO1Q7Z5wlk1wbHkwiaxtdzh5GPfwvXzAtx8lRpdXyMY5prM53cdcEmG5ukexrbAiwF2xwfV8gdl8icXXW/j9IY2pciAbWRSP4NIU0+UK/SyHSyMHSQ/J4ByOe8qlEdJhjmxyjXR0Ccfz0Q1jBNRFSLoYxjHXhRlS0zTINJJDGt7crXG1uEWSZkjOUqTDMZeKE9brdTSbTTQaLBoHoWn1A6dV6rJ1YiEaXCAmU1hhZgwL86S9d/mjVXm7Ngdn6kISRTJApA2Q9lvwsgns/R+Rjz2siy0c+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DB 다이어그램\"\n        title=\"DB 다이어그램\"\n        src=\"/static/edc7bac8cfa06e0f2289847ddb81ed08/1d69c/diagram.png\"\n        srcset=\"/static/edc7bac8cfa06e0f2289847ddb81ed08/4dcb9/diagram.png 188w,\n/static/edc7bac8cfa06e0f2289847ddb81ed08/5ff7e/diagram.png 375w,\n/static/edc7bac8cfa06e0f2289847ddb81ed08/1d69c/diagram.png 750w,\n/static/edc7bac8cfa06e0f2289847ddb81ed08/d53ff/diagram.png 1068w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"1-하위-엔티티를-조회하지-않는-경우\" style=\"position:relative;\"><a href=\"#1-%ED%95%98%EC%9C%84-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"1 하위 엔티티를 조회하지 않는 경우 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 하위 엔티티를 조회하지 않는 경우</h2>\n<p><strong>Album의 Song에 접근하지 않은 경우</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> N1_쿼리테스트<span class=\"token function\">_1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Album</span><span class=\"token punctuation\">></span></span> albums <span class=\"token operator\">=</span> albumRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"lazy-방식-결과\" style=\"position:relative;\"><a href=\"#lazy-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC\" aria-label=\"lazy 방식 결과 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LAZY 방식 결과</h4>\n<p>하위 엔티티에 접근하지 않았기 때문에 <code class=\"language-text\">Album</code>만 가져오는 것을 볼 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5ededfa60eaa01b673c0709e2d89c049/f238d/lazy-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 2.6595744680851063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAP0lEQVQI1x2J2wkAQQgDrygXdVd8gP23lEM/AjOTz8zw3sM5B92NcXffTb/3QlWRmevTiQgRgaqCiCzPx8z4AUogIfEqUBzIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"LAZY 방식\"\n        title=\"LAZY 방식\"\n        src=\"/static/5ededfa60eaa01b673c0709e2d89c049/1d69c/lazy-1.png\"\n        srcset=\"/static/5ededfa60eaa01b673c0709e2d89c049/4dcb9/lazy-1.png 188w,\n/static/5ededfa60eaa01b673c0709e2d89c049/5ff7e/lazy-1.png 375w,\n/static/5ededfa60eaa01b673c0709e2d89c049/1d69c/lazy-1.png 750w,\n/static/5ededfa60eaa01b673c0709e2d89c049/78797/lazy-1.png 1125w,\n/static/5ededfa60eaa01b673c0709e2d89c049/aa440/lazy-1.png 1500w,\n/static/5ededfa60eaa01b673c0709e2d89c049/f238d/lazy-1.png 2078w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"eager-방식-결과\" style=\"position:relative;\"><a href=\"#eager-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC\" aria-label=\"eager 방식 결과 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EAGER 방식 결과</h4>\n<p><strong>N+1 발생 !</strong></p>\n<p><code class=\"language-text\">JPQL</code>에서 동작한 쿼리를 통해서 <code class=\"language-text\">Album</code> 데이터를 조회합니다.<br>\n그 이후 <code class=\"language-text\">JPA</code>에서는 글로벌 패치 전략(<code class=\"language-text\">EAGER</code> 로딩)을 보고 <code class=\"language-text\">Album</code>의 <code class=\"language-text\">Song</code> 대해서 추가적인 로딩 작업을 진행해 <code class=\"language-text\">N+1 문제</code>를 발생시킵니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ed00f430126589211d379f6a7759143d/5b2ff/eager-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAc0lEQVQY01WPSQ7AMAgD+VRO2bf/P4lqkFy1h8jjYAixtZaPMbz37l8+54TKt9ZC55zBtdao4TlwSskNo4a9dwwVo3iaNZBGuJQSrBxK3QANZSs8wXvvL6ijLANhesijPGzaTgGKYn0LD2tTfM75fYB76QPtVIs53/n24QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"EAGER 방식\"\n        title=\"EAGER 방식\"\n        src=\"/static/ed00f430126589211d379f6a7759143d/1d69c/eager-1.png\"\n        srcset=\"/static/ed00f430126589211d379f6a7759143d/4dcb9/eager-1.png 188w,\n/static/ed00f430126589211d379f6a7759143d/5ff7e/eager-1.png 375w,\n/static/ed00f430126589211d379f6a7759143d/1d69c/eager-1.png 750w,\n/static/ed00f430126589211d379f6a7759143d/78797/eager-1.png 1125w,\n/static/ed00f430126589211d379f6a7759143d/aa440/eager-1.png 1500w,\n/static/ed00f430126589211d379f6a7759143d/5b2ff/eager-1.png 2190w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"2-하위-엔티티를-조회하는-경우\" style=\"position:relative;\"><a href=\"#2-%ED%95%98%EC%9C%84-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"2 하위 엔티티를 조회하는 경우 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 하위 엔티티를 조회하는 경우</h2>\n<p><code class=\"language-text\">LAZY</code> 로딩을 하기 위해서는 해당 <code class=\"language-text\">Entity</code>가 영속 상태여야 합니다.<br>\n보통 Repository에서 리스트로 가져오면 영속이 끊긴 상태로 가져오기 때문에 <code class=\"language-text\">LAZY</code> 전략 테스팅 시 <code class=\"language-text\">@Transactional</code>를 꼭 사용해야합니다 !</p>\n<p><code class=\"language-text\">@Transactional</code>을 사용하지 않으면 다음과 같은 에러가 발생합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/922868e893bb9f17fc4d75c22953f61c/42267/proxy-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.148936170212767%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAvUlEQVQY012PSQ7CMBAE85woG2CP42wOiEVCCiFh+f9XmraxOHAo9chjlXqSm9LwzPqb151iKpxMj9E4jMKUDpfaYmoaHLg7bLZoqwpSljBEE1UUEL4lqxa8xQThPUqfIlikxl1sYNYGqzE4OYdhGND3PQbSWYsNZUWe/0gWSrxwik2nKHx5uHswz22LI/GS/Tii46zYtKQsTVNkWfYjCF//QrYOLblbOF957sULYzvH9Ni6huafiqd6Wc6GH7bvhF799gj8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"프록시 에러\"\n        title=\"프록시 에러\"\n        src=\"/static/922868e893bb9f17fc4d75c22953f61c/1d69c/proxy-error.png\"\n        srcset=\"/static/922868e893bb9f17fc4d75c22953f61c/4dcb9/proxy-error.png 188w,\n/static/922868e893bb9f17fc4d75c22953f61c/5ff7e/proxy-error.png 375w,\n/static/922868e893bb9f17fc4d75c22953f61c/1d69c/proxy-error.png 750w,\n/static/922868e893bb9f17fc4d75c22953f61c/78797/proxy-error.png 1125w,\n/static/922868e893bb9f17fc4d75c22953f61c/aa440/proxy-error.png 1500w,\n/static/922868e893bb9f17fc4d75c22953f61c/42267/proxy-error.png 2670w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>Album의 Song에 접근하는 경우</strong></p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token annotation punctuation\">@Transactional</span> <span class=\"token comment\">// 테스팅에서 LAZY 전략시 필수</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> N1_쿼리테스트<span class=\"token function\">_2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Album</span><span class=\"token punctuation\">></span></span> albums <span class=\"token operator\">=</span> albumRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Album</span> album <span class=\"token operator\">:</span> albums<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>album<span class=\"token punctuation\">.</span><span class=\"token function\">getSongs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Song에 접근 !</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"lazy-방식-결과-1\" style=\"position:relative;\"><a href=\"#lazy-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC-1\" aria-label=\"lazy 방식 결과 1 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LAZY 방식 결과</h4>\n<p><strong>N+1 발생 !</strong></p>\n<p>처음엔 <code class=\"language-text\">Album</code> 리스트만 조회했지만 <code class=\"language-text\">Album</code> 엔티티에서 하위 엔티티인 <code class=\"language-text\">Song</code> 엔티티로 접근했기 때문에 <code class=\"language-text\">LAZY</code> 로딩이 일어나면서 <code class=\"language-text\">N+1 문제</code> 발생\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a862e7a46a9b1e5d0c728276a25b79ec/a7115/lazy-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.95744680851064%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAz0lEQVQoz2WRWQ6DQAxDuRI7Yh1A4v43CnqWXKXth5VlEo+TVOd5RikljuOI67pi3/dYlkUxFqzrGvM8y9+2TT4gD8jx1jRNVJBBBMF93ypo2zaGYfiyXdcJfd8rphmfd/JYYhFmlQBSlPIzoNBkJoCUeBzHjyUvQgABY0zTpCZbF2bSTPinkDFR6P15JI9qgjyyCf1hVlpBwpi/No+eD4APmfeaFWpklKES+zyPfF+aIgj4HbAGYJXO5RVJoXfIAUjWda0GLumLGo6pscpsXx14CZCWTADAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"LAZY 방식2\"\n        title=\"LAZY 방식2\"\n        src=\"/static/a862e7a46a9b1e5d0c728276a25b79ec/1d69c/lazy-2.png\"\n        srcset=\"/static/a862e7a46a9b1e5d0c728276a25b79ec/4dcb9/lazy-2.png 188w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/5ff7e/lazy-2.png 375w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/1d69c/lazy-2.png 750w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/78797/lazy-2.png 1125w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/aa440/lazy-2.png 1500w,\n/static/a862e7a46a9b1e5d0c728276a25b79ec/a7115/lazy-2.png 2186w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"eager-방식-결과-1\" style=\"position:relative;\"><a href=\"#eager-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC-1\" aria-label=\"eager 방식 결과 1 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EAGER 방식 결과</h4>\n<p><strong>N+1 발생 !</strong></p>\n<p><strong>‘하위 엔티티를 조회하지 않는 경우’</strong>의 <code class=\"language-text\">EAGER</code> 방식 결과와 동일하게 <code class=\"language-text\">N+1 문제</code>가 발생하는 것을 볼 수 있습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/988b3b4ebe7eff963353b86df5d09744/a7115/eager-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.82978723404255%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0UlEQVQoz42QR46GUAyD33XobQGid+5/ooy+SEb/LKYsLJsQJ34J8zzbOI62bZsty2LTNLmmjuafetZ1dR6GwXEch3360WHfd2+8rssbpGnQPy07z9MZI/w8j/eg5QlqkFma+qdZyZUaaAE1eYK2s4EiA0hKjQVi1XUK+L7vb+np8ydT5KPveyvL0oqisKqqXKdpakmSvPwXgm7Utq0PyvPcIR3HsUVR5PwfBB2f2F3X+eCmaTyhuK7rFyTF+GNC3q6bMYwBJMuy7AVDBEy/DfwCSPIIOm/eojAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"EAGER 방식2\"\n        title=\"EAGER 방식2\"\n        src=\"/static/988b3b4ebe7eff963353b86df5d09744/1d69c/eager-2.png\"\n        srcset=\"/static/988b3b4ebe7eff963353b86df5d09744/4dcb9/eager-2.png 188w,\n/static/988b3b4ebe7eff963353b86df5d09744/5ff7e/eager-2.png 375w,\n/static/988b3b4ebe7eff963353b86df5d09744/1d69c/eager-2.png 750w,\n/static/988b3b4ebe7eff963353b86df5d09744/78797/eager-2.png 1125w,\n/static/988b3b4ebe7eff963353b86df5d09744/aa440/eager-2.png 1500w,\n/static/988b3b4ebe7eff963353b86df5d09744/a7115/eager-2.png 2186w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"n1-문제-해결-방법\" style=\"position:relative;\"><a href=\"#n1-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"n1 문제 해결 방법 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>N+1 문제 해결 방법</h2>\n<h4 id=\"1-패치-조인fetch-join\" style=\"position:relative;\"><a href=\"#1-%ED%8C%A8%EC%B9%98-%EC%A1%B0%EC%9D%B8fetch-join\" aria-label=\"1 패치 조인fetch join permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 패치 조인(Fetch Join)</h4>\n<p>미리 쿼리로 테이블을 조인해서 가져오기 때문에 <code class=\"language-text\">LAZY</code>, <code class=\"language-text\">EAGER</code> 두개의 전략에 해당되는 해결법입니다.</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select DISTINCT a from Album a join fetch a.songs\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Album</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllJoinFetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token annotation punctuation\">@Transactional</span> <span class=\"token comment\">// 테스팅에서 LAZY 전략시 사용해야 동작</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">FetchJoin_</span>테스트<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Album</span><span class=\"token punctuation\">></span></span> albums <span class=\"token operator\">=</span> albumRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllJoinFetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Album</span> album <span class=\"token operator\">:</span> albums<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>album<span class=\"token punctuation\">.</span><span class=\"token function\">getSongs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Song에 접근 !</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f70753372a0f56ab5dbfeab63a3093e6/00e09/fetch-join.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.914893617021278%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwElEQVQY022QVwpDMQwEfZ3Xe+/t/kfaMAKHR8jHspYtjWS5eZ61bZtwtK6rjuPQNE12T7wsiznxOI7a913XdVlMLnXneaptW7m6ri2BxzcAIIne329936tpGpVl+XU4uCPxeR7reN+3wSnI81xFUVgSyrJMURQpjmOFYaggCP7KAWJsYHSvqkppmipJEnNAOCBfBBDR4Fc2IVN5dV1nu8D5Bg1w/yV/hwD8gp1fKPvBaTAMgxUyHZN6MeX7/A/4Ac75wp74czEiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"패치 조인\"\n        title=\"패치 조인\"\n        src=\"/static/f70753372a0f56ab5dbfeab63a3093e6/1d69c/fetch-join.png\"\n        srcset=\"/static/f70753372a0f56ab5dbfeab63a3093e6/4dcb9/fetch-join.png 188w,\n/static/f70753372a0f56ab5dbfeab63a3093e6/5ff7e/fetch-join.png 375w,\n/static/f70753372a0f56ab5dbfeab63a3093e6/1d69c/fetch-join.png 750w,\n/static/f70753372a0f56ab5dbfeab63a3093e6/78797/fetch-join.png 1125w,\n/static/f70753372a0f56ab5dbfeab63a3093e6/aa440/fetch-join.png 1500w,\n/static/f70753372a0f56ab5dbfeab63a3093e6/00e09/fetch-join.png 1854w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>결과를 보면 쿼리는 <code class=\"language-text\">1번</code> 발생했고 미리 <code class=\"language-text\">Album</code>과 <code class=\"language-text\">Song</code>을 조인해서 가져오는 것을 확인 할 수 있습니다.</p>\n<p>하지만, 패치 조인에는 단점 2가지가 있습니다.</p>\n<ol>\n<li><code class=\"language-text\">JPA</code>가 제공하는 <code class=\"language-text\">Pagable</code> 기능 사용 불가 (페이징 API)</li>\n<li>\n<p><code class=\"language-text\">1:N</code> 관계가 2개인 엔티티를 패치 조인 사용 불가</p>\n<blockquote>\n<p>임시 해결법은 <code class=\"language-text\">List -&gt; Set</code>으로 자료구조를 변경하는 것</p>\n</blockquote>\n</li>\n</ol>\n<h4 id=\"2-batch-size-조절\" style=\"position:relative;\"><a href=\"#2-batch-size-%EC%A1%B0%EC%A0%88\" aria-label=\"2 batch size 조절 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Batch Size 조절</h4>\n<p>설정한 <code class=\"language-text\">Size</code>만큼 데이터를 미리 로딩합니다. (<code class=\"language-text\">where in</code>을 사용하여)<br>\n<code class=\"language-text\">JPA</code>의 페이징 API 기능처럼 개수가 고정된 데이터를 가져올 때 함께 사용할 때 유용하게 사용 가능할 듯합니다.</p>\n<p>하지만, 글로벌 패치 전략을 <code class=\"language-text\">EAGER</code>로 변경해야하는 단점이 존재합니다.</p>\n<div class=\"gatsby-code-title\">Java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@BatchSize</span><span class=\"token punctuation\">(</span>size <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"album\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span>ALL<span class=\"token punctuation\">,</span> fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>EAGER<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Song</span><span class=\"token punctuation\">></span></span> songs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d53bc563989b95a8061d693eaa089613/497e9/batch-size.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.638297872340425%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAWElEQVQI102MSwoAIQxDvZYo4hcV9f7HiSTgMItHk7SNaa2hlIKUEnrvn661ipyzeDknc+rn/zeGhXNOlZ1zpMkYQ6y1sPfWnjk9f2KMKgwhwDkHay2897iKbke8Sdu2xgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"배치 사이즈 조절\"\n        title=\"배치 사이즈 조절\"\n        src=\"/static/d53bc563989b95a8061d693eaa089613/1d69c/batch-size.png\"\n        srcset=\"/static/d53bc563989b95a8061d693eaa089613/4dcb9/batch-size.png 188w,\n/static/d53bc563989b95a8061d693eaa089613/5ff7e/batch-size.png 375w,\n/static/d53bc563989b95a8061d693eaa089613/1d69c/batch-size.png 750w,\n/static/d53bc563989b95a8061d693eaa089613/78797/batch-size.png 1125w,\n/static/d53bc563989b95a8061d693eaa089613/aa440/batch-size.png 1500w,\n/static/d53bc563989b95a8061d693eaa089613/497e9/batch-size.png 2064w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"또-다른-방식의-해결-방법\" style=\"position:relative;\"><a href=\"#%EB%98%90-%EB%8B%A4%EB%A5%B8-%EB%B0%A9%EC%8B%9D%EC%9D%98-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"또 다른 방식의 해결 방법 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>또 다른 방식의 해결 방법?</h4>\n<p><code class=\"language-text\">@EntityGraph</code> 를 사용해 <code class=\"language-text\">N+1 문제</code>를 해결하는 방식도 존재합니다만 이번 포스팅에서는 다루지 않습니다 !</p>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<p><a href=\"https://vladmihalcea.com/n-plus-1-query-problem/\">Vlad Mihalcea - N+1 query problem with JPA and Hibernate</a><br>\n<a href=\"https://stackoverflow.com/questions/32453989/what-is-the-solution-for-the-n1-issue-in-jpa-and-hibernate\">Stack Overflow - What is the solution for the N+1 issue in JPA and Hibernate?</a><br>\n<a href=\"https://www.popit.kr/jpa-n1-%EB%B0%9C%EC%83%9D%EC%9B%90%EC%9D%B8%EA%B3%BC-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95/\">Yun - JPA N+1 발생원인과 해결 방법</a><br>\n<a href=\"https://kapentaz.github.io/jpa/hibernate/@ManyToOne%EC%9D%98-N+1-%EB%AC%B8%EC%A0%9C-%EC%9B%90%EC%9D%B8-%EB%B0%8F-%ED%95%B4%EA%B2%B0/#\">kapentaz - @ManyToOne의 N+1 문제 원인 및 해결</a></p>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>Spring JPA의 N+1 문제에 대해 알아보고, 발생하는 경우와 해결 방법에 대해서 알아보았습니다.</p>\n<p>긴글 봐주셔서 감사합니다. 🙇🏻‍♂️</p>","tableOfContents":"<ul>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#%EA%B0%9C%EC%9A%94\">개요</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#n1-%EC%BF%BC%EB%A6%AC-%EB%AC%B8%EC%A0%9C%EC%9D%98-%EC%9B%90%EC%9D%B8-\">N+1 쿼리 문제의 원인 ?</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#n1-%EC%BF%BC%EB%A6%AC-%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%96%B8%EC%A0%9C-%EB%B0%9C%EC%83%9D%ED%95%A0%EA%B9%8C-\">N+1 쿼리 문제는 언제 발생할까 ?</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%AA%A8%EB%8D%B8%EB%A7%81\">엔티티 모델링</a></li>\n<li>\n<p><a href=\"/category/blog/spring-jpa-n+1-query/#1-%ED%95%98%EC%9C%84-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94-%EA%B2%BD%EC%9A%B0\">1. 하위 엔티티를 조회하지 않는 경우</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#lazy-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC\">LAZY 방식 결과</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#eager-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC\">EAGER 방식 결과</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/blog/spring-jpa-n+1-query/#2-%ED%95%98%EC%9C%84-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\">2. 하위 엔티티를 조회하는 경우</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#lazy-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC-1\">LAZY 방식 결과</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#eager-%EB%B0%A9%EC%8B%9D-%EA%B2%B0%EA%B3%BC-1\">EAGER 방식 결과</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/blog/spring-jpa-n+1-query/#n1-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\">N+1 문제 해결 방법</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#1-%ED%8C%A8%EC%B9%98-%EC%A1%B0%EC%9D%B8fetch-join\">1. 패치 조인(Fetch Join)</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#2-batch-size-%EC%A1%B0%EC%A0%88\">2. Batch Size 조절</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#%EB%98%90-%EB%8B%A4%EB%A5%B8-%EB%B0%A9%EC%8B%9D%EC%9D%98-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\">또 다른 방식의 해결 방법?</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#reference\">Reference</a></li>\n<li><a href=\"/category/blog/spring-jpa-n+1-query/#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></li>\n</ul>","frontmatter":{"title":"Spring JPA(ORM)의 N+1 쿼리 문제 해결","description":"Spring JPA N+1 쿼리 문제에 대해서","date":"2020.06.29","emoji":"✅","category":"blog"}}},"pageContext":{"slug":"/category/blog/spring-jpa-n+1-query/","relatedPosts":[{"node":{"fields":{"slug":"/category/blog/spring/redis/spring-data-redis-version-issue/"},"frontmatter":{"title":"[Spring Redis] Spring Boot 2.3.2.RELEASE 버전 Redis 이슈","date":"2020.11.20","emoji":"❓","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/spring-transactional-precautions/"},"frontmatter":{"title":"[Spring] @Transactional 사용 시 주의점과 JPQL 주의점","date":"2020.11.14","emoji":"🚧","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/spring-jpa-one-to-many-save-issue/"},"frontmatter":{"title":"[Spring JPA] 1:N 관계 엔티티 save시 update 쿼리가 추가로 발생하는 이슈","date":"2020.09.25","emoji":"💭","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/aws-eb-deploy/"},"frontmatter":{"title":"[AWS EB] AWS Elastic Beanstalk로 서버 배포 하기","date":"2020.09.02","emoji":"🚀","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/http-post-redirect-to-get/"},"frontmatter":{"title":"왜 리다이렉트시 HTTP 메소드들은 GET 메서드로 리다이렉션 될까?","date":"2020.08.27","emoji":"❔","category":"blog"}}}]}}}